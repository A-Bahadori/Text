using System;
using System.Collections.Generic;
using System.Drawing;
using System.Linq;
using System.Windows.Forms;

namespace EmojiSelectorApp
{
    public partial class MainForm : Form
    {
        private TextBox txtMessage;
        private Button btnEmoji;
        private EmojiPopupForm emojiPopup;
        private List<string> favoriteEmojis;
        private Dictionary<string, List<string>> emojiCategories;
        private const string FAVORITES_FILE = "favorites.txt";
        
        // Ø¯ÛŒÚ©Ø´Ù†Ø±ÛŒ Ø¨Ø±Ø§ÛŒ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø§Ù…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§
        private Dictionary<string, List<string>> emojiCategories;

        public MainForm()
        {
            InitializeComponent();
            InitializeEmojiCategories();
            LoadFavoriteEmojis();
            SetupControls();
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ú©Ù„ÛŒØ¯ Ù…ÛŒØ§Ù†Ø¨Ø± (Ctrl+E) Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´/Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ù¾Ù†Ù„ Ø§Ù…ÙˆØ¬ÛŒ
            this.KeyPreview = true;
            this.KeyDown += MainForm_KeyDown;
        }

        private void MainForm_KeyDown(object sender, KeyEventArgs e)
        {
            // Ù…ÛŒØ§Ù†Ø¨Ø± Ctrl+E Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´/Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ù¾Ù†Ù„ Ø§Ù…ÙˆØ¬ÛŒ
            if (e.Control && e.KeyCode == Keys.E)
            {
                e.SuppressKeyPress = true;
                ToggleEmojiPopup();
            }
        }

        private void ToggleEmojiPopup()
        {
            if (emojiPopup == null || emojiPopup.IsDisposed)
            {
                emojiPopup = new EmojiPopupForm(this);
                emojiPopup.EmojiSelected += OnEmojiSelected;
                emojiPopup.FavoriteEmojisChanged += OnFavoriteEmojisChanged;
            }

            if (!emojiPopup.Visible)
            {
                Point popupLocation = new Point(
                    btnEmoji.PointToScreen(new Point(0, btnEmoji.Height)).X,
                    btnEmoji.PointToScreen(new Point(0, btnEmoji.Height)).Y
                );
                emojiPopup.Location = popupLocation;
                emojiPopup.Show();
            }
            else
            {
                emojiPopup.Hide();
            }
        }

        private void OnEmojiSelected(string emoji)
        {
            int cursorPosition = txtMessage.SelectionStart;
            txtMessage.Text = txtMessage.Text.Insert(cursorPosition, emoji);
            txtMessage.SelectionStart = cursorPosition + emoji.Length;
            txtMessage.Focus();
        }

        private void OnFavoriteEmojisChanged(List<string> newFavorites)
        {
            favoriteEmojis = newFavorites;
            SaveFavoriteEmojis();
        }

        private void LoadFavoriteEmojis()
        {
            try
            {
                if (System.IO.File.Exists(FAVORITES_FILE))
                {
                    favoriteEmojis = System.IO.File.ReadAllLines(FAVORITES_FILE).ToList();
                }
                else
                {
                    favoriteEmojis = new List<string>() { "ğŸ‘", "ğŸ‘‹", "â¤ï¸", "ğŸ˜‚", "ğŸ™", "ğŸ‘", "ğŸ”¥", "ğŸ‰" };
                }
            }
            catch
            {
                favoriteEmojis = new List<string>() { "ğŸ‘", "ğŸ‘‹", "â¤ï¸", "ğŸ˜‚", "ğŸ™", "ğŸ‘", "ğŸ”¥", "ğŸ‰" };
            }
        }

        private void SaveFavoriteEmojis()
        {
            try
            {
                System.IO.File.WriteAllLines(FAVORITES_FILE, favoriteEmojis);
            }
            catch
            {
                // Handle save error silently
            }
        }

        private void InitializeEmojiCategories()
        {
            // Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù Ø§Ù…ÙˆØ¬ÛŒ
            emojiCategories = new Dictionary<string, List<string>>();
            
            // Ø¯Ø³ØªÙ‡ Ø§Ø­Ø³Ø§Ø³Ø§Øª Ùˆ ØµÙˆØ±Øªâ€ŒÙ‡Ø§
            emojiCategories["Ø§Ø­Ø³Ø§Ø³Ø§Øª"] = new List<string>()
            {
                "ğŸ˜€", "ğŸ˜", "ğŸ˜‚", "ğŸ¤£", "ğŸ˜ƒ", "ğŸ˜„", "ğŸ˜…", "ğŸ˜†",
                "ğŸ˜‰", "ğŸ˜Š", "ğŸ˜‹", "ğŸ˜", "ğŸ˜", "ğŸ˜˜", "ğŸ¥°", "ğŸ˜—",
                "ğŸ˜™", "ğŸ˜š", "ğŸ™‚", "ğŸ¤—", "ğŸ¤©", "ğŸ¤”", "ğŸ¤¨", "ğŸ˜",
                "ğŸ˜‘", "ğŸ˜¶", "ğŸ™„", "ğŸ˜", "ğŸ˜£", "ğŸ˜¥", "ğŸ˜®", "ğŸ¤",
                "ğŸ˜¯", "ğŸ˜ª", "ğŸ˜«", "ğŸ¥±", "ğŸ˜´", "ğŸ˜Œ", "ğŸ˜›", "ğŸ˜œ",
                "ğŸ˜", "ğŸ¤¤", "ğŸ˜’", "ğŸ˜“", "ğŸ˜”", "ğŸ˜•", "ğŸ™ƒ", "ğŸ¤‘",
                "ğŸ˜²", "â˜¹ï¸", "ğŸ™", "ğŸ˜–", "ğŸ˜", "ğŸ˜Ÿ", "ğŸ˜¤", "ğŸ˜¢",
                "ğŸ˜­", "ğŸ˜¦", "ğŸ˜§", "ğŸ˜¨", "ğŸ˜©", "ğŸ¤¯", "ğŸ˜¬", "ğŸ˜°"
            };
            
            // Ø¯Ø³ØªÙ‡ Ø­ÛŒÙˆØ§Ù†Ø§Øª
            emojiCategories["Ø­ÛŒÙˆØ§Ù†Ø§Øª"] = new List<string>()
            {
                "ğŸ¶", "ğŸ±", "ğŸ­", "ğŸ¹", "ğŸ°", "ğŸ¦Š", "ğŸ»", "ğŸ¼",
                "ğŸ¨", "ğŸ¯", "ğŸ¦", "ğŸ®", "ğŸ·", "ğŸ¸", "ğŸµ", "ğŸ”",
                "ğŸ§", "ğŸ¦", "ğŸ¤", "ğŸ¦†", "ğŸ¦…", "ğŸ¦‰", "ğŸ¦‡", "ğŸº",
                "ğŸ—", "ğŸ´", "ğŸ¦„", "ğŸ", "ğŸ›", "ğŸ¦‹", "ğŸŒ", "ğŸ",
                "ğŸœ", "ğŸ¦Ÿ", "ğŸ¦—", "ğŸ•·ï¸", "ğŸ¦‚", "ğŸ¢", "ğŸ", "ğŸ¦",
                "ğŸ¦–", "ğŸ¦•", "ğŸ™", "ğŸ¦‘", "ğŸ¦", "ğŸ¦", "ğŸ¦€", "ğŸ¡",
                "ğŸ ", "ğŸŸ", "ğŸ¬", "ğŸ³", "ğŸ‹", "ğŸ¦ˆ", "ğŸŠ", "ğŸ…"
            };
            
            // Ø¯Ø³ØªÙ‡ ØºØ°Ø§Ù‡Ø§
            emojiCategories["ØºØ°Ø§Ù‡Ø§"] = new List<string>()
            {
                "ğŸ", "ğŸ", "ğŸ", "ğŸŠ", "ğŸ‹", "ğŸŒ", "ğŸ‰", "ğŸ‡",
                "ğŸ“", "ğŸˆ", "ğŸ’", "ğŸ‘", "ğŸ¥­", "ğŸ", "ğŸ¥¥", "ğŸ¥",
                "ğŸ…", "ğŸ†", "ğŸ¥‘", "ğŸ¥¦", "ğŸ¥¬", "ğŸ¥’", "ğŸŒ¶ï¸", "ğŸŒ½",
                "ğŸ¥•", "ğŸ§„", "ğŸ§…", "ğŸ¥”", "ğŸ ", "ğŸ¥", "ğŸ¥¯", "ğŸ",
                "ğŸ¥–", "ğŸ¥¨", "ğŸ§€", "ğŸ¥š", "ğŸ³", "ğŸ§ˆ", "ğŸ¥", "ğŸ§‡",
                "ğŸ¥“", "ğŸ¥©", "ğŸ—", "ğŸ–", "ğŸŒ­", "ğŸ”", "ğŸŸ", "ğŸ•",
                "ğŸ¥ª", "ğŸ¥™", "ğŸ§†", "ğŸŒ®", "ğŸŒ¯", "ğŸ¥—", "ğŸ¥˜", "ğŸ¥«"
            };
            
            // Ø¯Ø³ØªÙ‡ Ø¹Ù„Ø§Ø¦Ù… Ùˆ Ù†Ù…Ø§Ø¯Ù‡Ø§
            emojiCategories["Ù†Ù…Ø§Ø¯Ù‡Ø§"] = new List<string>()
            {
                "â¤ï¸", "ğŸ§¡", "ğŸ’›", "ğŸ’š", "ğŸ’™", "ğŸ’œ", "ğŸ–¤", "ğŸ¤",
                "ğŸ¤", "ğŸ’”", "â£ï¸", "ğŸ’•", "ğŸ’", "ğŸ’“", "ğŸ’—", "ğŸ’–",
                "ğŸ’˜", "ğŸ’", "ğŸ’Ÿ", "â˜®ï¸", "âœï¸", "â˜ªï¸", "ğŸ•‰ï¸", "â˜¸ï¸",
                "âœ¡ï¸", "ğŸ”¯", "ğŸ•", "â˜¯ï¸", "â˜¦ï¸", "ğŸ›", "â›", "â™ˆ",
                "â™‰", "â™Š", "â™‹", "â™Œ", "â™", "â™", "â™", "â™",
                "â™‘", "â™’", "â™“", "ğŸ†”", "âš›ï¸", "ğŸ‰‘", "â˜¢ï¸", "â˜£ï¸",
                "ğŸ“´", "ğŸ“³", "ğŸˆ¶", "ğŸˆš", "ğŸˆ¸", "ğŸˆº", "ğŸˆ·ï¸", "âœ´ï¸"
            };
            
            // Ø¯Ø³ØªÙ‡ Ø§Ø´ÛŒØ§Ø¡
            emojiCategories["Ø§Ø´ÛŒØ§Ø¡"] = new List<string>()
            {
                "âŒš", "ğŸ“±", "ğŸ’»", "âŒ¨ï¸", "ğŸ–¥ï¸", "ğŸ–¨ï¸", "ğŸ–±ï¸", "ğŸ–²ï¸",
                "ğŸ’½", "ğŸ’¾", "ğŸ’¿", "ğŸ“€", "ğŸ“¼", "ğŸ“·", "ğŸ“¸", "ğŸ“¹",
                "ğŸ¥", "ğŸ“½ï¸", "ğŸï¸", "ğŸ“", "â˜ï¸", "ğŸ“Ÿ", "ğŸ“ ", "ğŸ“º",
                "ğŸ“»", "ğŸ™ï¸", "ğŸšï¸", "ğŸ›ï¸", "ğŸ§­", "â±ï¸", "â²ï¸", "â°",
                "ğŸ•°ï¸", "âŒ›", "â³", "ğŸ“¡", "ğŸ”‹", "ğŸ”Œ", "ğŸ’¡", "ğŸ”¦",
                "ğŸ•¯ï¸", "ğŸ§¯", "ğŸ›¢ï¸", "ğŸ’¸", "ğŸ’µ", "ğŸ’´", "ğŸ’¶", "ğŸ’·",
                "ğŸ’°", "ğŸ’³", "ğŸ’", "âš–ï¸", "ğŸ§°", "ğŸ”§", "ğŸ”¨", "âš’ï¸"
            };
            
            // Ø§Ù…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ú©Ø§Ø±Ø¨Ø±Ø¯ Ø§ÙˆÙ„ÛŒÙ‡
            favoriteEmojis = new List<string>() { "ğŸ‘", "ğŸ‘‹", "â¤ï¸", "ğŸ˜‚", "ğŸ™", "ğŸ‘", "ğŸ”¥", "ğŸ‰" };
        }

        private void SetupControls()
        {
            // ØªÙ†Ø¸ÛŒÙ… ÙØ±Ù… Ø§ØµÙ„ÛŒ
            this.Text = "Ù¾ÛŒØ§Ù…â€ŒØ±Ø³Ø§Ù† Ø¨Ø§ Ø§Ù†ØªØ®Ø§Ø¨Ú¯Ø± Ø§Ù…ÙˆØ¬ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡";
            this.Size = new Size(600, 550);
            this.StartPosition = FormStartPosition.CenterScreen;
            this.RightToLeft = RightToLeft.Yes; // Ø¨Ø±Ø§ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² Ø²Ø¨Ø§Ù† ÙØ§Ø±Ø³ÛŒ
            
            // Ø§ÛŒØ¬Ø§Ø¯ TextBox Ø¨Ø±Ø§ÛŒ Ù†ÙˆØ´ØªÙ† Ù¾ÛŒØ§Ù…
            txtMessage = new TextBox
            {
                Multiline = true,
                Location = new Point(10, 10),
                Size = new Size(500, 100),
                Font = new Font("Segoe UI", 12),
                RightToLeft = RightToLeft.Yes,
                ScrollBars = ScrollBars.Vertical
            };
            this.Controls.Add(txtMessage);
            
            // Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ú©Ù…Ù‡ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù¾Ù†Ù„ Ø§Ù…ÙˆØ¬ÛŒ
            btnEmoji = new Button
            {
                Text = "ğŸ˜Š",
                Location = new Point(520, 10),
                Size = new Size(50, 50),
                Font = new Font("Segoe UI", 16)
            };
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† ØªÙˆÙ„ØªÛŒÙ¾ Ø¨Ù‡ Ø¯Ú©Ù…Ù‡ Ø§Ù…ÙˆØ¬ÛŒ
            ToolTip emojiButtonTooltip = new ToolTip();
            emojiButtonTooltip.SetToolTip(btnEmoji, "Ù†Ù…Ø§ÛŒØ´ Ø§Ù…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ (Ctrl+E)");
            btnEmoji.Click += (s, e) => ToggleEmojiPopup();
            this.Controls.Add(btnEmoji);
        }

        [STAThread]
        static void Main()
        {
            Application.EnableVisualStyles();
            Application.SetCompatibleTextRenderingDefault(false);
            Application.Run(new MainForm());
        }
    }

    public class EmojiPopupForm : Form
    {
        private TextBox txtSearch;
        private TabControl tabEmojiCategories;
        private FlowLayoutPanel favoriteEmojisPanel;
        private List<string> favoriteEmojis;
        private Dictionary<string, List<string>> emojiCategories;
        private MainForm parentForm;

        public event Action<string> EmojiSelected;
        public event Action<List<string>> FavoriteEmojisChanged;

        public EmojiPopupForm(MainForm parent)
        {
            parentForm = parent;
            InitializePopup();
            InitializeEmojiCategories();
            LoadFavoriteEmojis();
            SetupControls();
        }

        private void InitializePopup()
        {
            this.FormBorderStyle = FormBorderStyle.None;
            this.Size = new Size(400, 500);
            this.ShowInTaskbar = false;
            this.TopMost = true;
            this.StartPosition = FormStartPosition.Manual;
            this.RightToLeft = RightToLeft.Yes;
            this.BackColor = Color.White;
            this.Paint += (s, e) => 
            {
                e.Graphics.DrawRectangle(new Pen(Color.LightGray), 0, 0, Width - 1, Height - 1);
            };
        }

        private void LoadFavoriteEmojis()
        {
            favoriteEmojis = parentForm.favoriteEmojis;
        }

        private void InitializeEmojiCategories()
        {
            emojiCategories = new Dictionary<string, List<string>>();
            
            // Ø¯Ø³ØªÙ‡ Ø§Ø­Ø³Ø§Ø³Ø§Øª Ùˆ ØµÙˆØ±Øªâ€ŒÙ‡Ø§
            emojiCategories["Ø§Ø­Ø³Ø§Ø³Ø§Øª"] = new List<string>()
            {
                "ğŸ˜€", "ğŸ˜", "ğŸ˜‚", "ğŸ¤£", "ğŸ˜ƒ", "ğŸ˜„", "ğŸ˜…", "ğŸ˜†",
                "ğŸ˜‰", "ğŸ˜Š", "ğŸ˜‹", "ğŸ˜", "ğŸ˜", "ğŸ˜˜", "ğŸ¥°", "ğŸ˜—",
                "ğŸ˜™", "ğŸ˜š", "ğŸ™‚", "ğŸ¤—", "ğŸ¤©", "ğŸ¤”", "ğŸ¤¨", "ğŸ˜",
                "ğŸ˜‘", "ğŸ˜¶", "ğŸ™„", "ğŸ˜", "ğŸ˜£", "ğŸ˜¥", "ğŸ˜®", "ğŸ¤",
                "ğŸ˜¯", "ğŸ˜ª", "ğŸ˜«", "ğŸ¥±", "ğŸ˜´", "ğŸ˜Œ", "ğŸ˜›", "ğŸ˜œ",
                "ğŸ˜", "ğŸ¤¤", "ğŸ˜’", "ğŸ˜“", "ğŸ˜”", "ğŸ˜•", "ğŸ™ƒ", "ğŸ¤‘",
                "ğŸ˜²", "â˜¹ï¸", "ğŸ™", "ğŸ˜–", "ğŸ˜", "ğŸ˜Ÿ", "ğŸ˜¤", "ğŸ˜¢",
                "ğŸ˜­", "ğŸ˜¦", "ğŸ˜§", "ğŸ˜¨", "ğŸ˜©", "ğŸ¤¯", "ğŸ˜¬", "ğŸ˜°"
            };
            
            // Ø¯Ø³ØªÙ‡ Ø­ÛŒÙˆØ§Ù†Ø§Øª
            emojiCategories["Ø­ÛŒÙˆØ§Ù†Ø§Øª"] = new List<string>()
            {
                "ğŸ¶", "ğŸ±", "ğŸ­", "ğŸ¹", "ğŸ°", "ğŸ¦Š", "ğŸ»", "ğŸ¼",
                "ğŸ¨", "ğŸ¯", "ğŸ¦", "ğŸ®", "ğŸ·", "ğŸ¸", "ğŸµ", "ğŸ”",
                "ğŸ§", "ğŸ¦", "ğŸ¤", "ğŸ¦†", "ğŸ¦…", "ğŸ¦‰", "ğŸ¦‡", "ğŸº",
                "ğŸ—", "ğŸ´", "ğŸ¦„", "ğŸ", "ğŸ›", "ğŸ¦‹", "ğŸŒ", "ğŸ",
                "ğŸœ", "ğŸ¦Ÿ", "ğŸ¦—", "ğŸ•·ï¸", "ğŸ¦‚", "ğŸ¢", "ğŸ", "ğŸ¦",
                "ğŸ¦–", "ğŸ¦•", "ğŸ™", "ğŸ¦‘", "ğŸ¦", "ğŸ¦", "ğŸ¦€", "ğŸ¡",
                "ğŸ ", "ğŸŸ", "ğŸ¬", "ğŸ³", "ğŸ‹", "ğŸ¦ˆ", "ğŸŠ", "ğŸ…"
            };
            
            // Ø¯Ø³ØªÙ‡ ØºØ°Ø§Ù‡Ø§
            emojiCategories["ØºØ°Ø§Ù‡Ø§"] = new List<string>()
            {
                "ğŸ", "ğŸ", "ğŸ", "ğŸŠ", "ğŸ‹", "ğŸŒ", "ğŸ‰", "ğŸ‡",
                "ğŸ“", "ğŸˆ", "ğŸ’", "ğŸ‘", "ğŸ¥­", "ğŸ", "ğŸ¥¥", "ğŸ¥",
                "ğŸ…", "ğŸ†", "ğŸ¥‘", "ğŸ¥¦", "ğŸ¥¬", "ğŸ¥’", "ğŸŒ¶ï¸", "ğŸŒ½",
                "ğŸ¥•", "ğŸ§„", "ğŸ§…", "ğŸ¥”", "ğŸ ", "ğŸ¥", "ğŸ¥¯", "ğŸ",
                "ğŸ¥–", "ğŸ¥¨", "ğŸ§€", "ğŸ¥š", "ğŸ³", "ğŸ§ˆ", "ğŸ¥", "ğŸ§‡",
                "ğŸ¥“", "ğŸ¥©", "ğŸ—", "ğŸ–", "ğŸŒ­", "ğŸ”", "ğŸŸ", "ğŸ•",
                "ğŸ¥ª", "ğŸ¥™", "ğŸ§†", "ğŸŒ®", "ğŸŒ¯", "ğŸ¥—", "ğŸ¥˜", "ğŸ¥«"
            };
            
            // Ø¯Ø³ØªÙ‡ Ø¹Ù„Ø§Ø¦Ù… Ùˆ Ù†Ù…Ø§Ø¯Ù‡Ø§
            emojiCategories["Ù†Ù…Ø§Ø¯Ù‡Ø§"] = new List<string>()
            {
                "â¤ï¸", "ğŸ§¡", "ğŸ’›", "ğŸ’š", "ğŸ’™", "ğŸ’œ", "ğŸ–¤", "ğŸ¤",
                "ğŸ¤", "ğŸ’”", "â£ï¸", "ğŸ’•", "ğŸ’", "ğŸ’“", "ğŸ’—", "ğŸ’–",
                "ğŸ’˜", "ğŸ’", "ğŸ’Ÿ", "â˜®ï¸", "âœï¸", "â˜ªï¸", "ğŸ•‰ï¸", "â˜¸ï¸",
                "âœ¡ï¸", "ğŸ”¯", "ğŸ•", "â˜¯ï¸", "â˜¦ï¸", "ğŸ›", "â›", "â™ˆ",
                "â™‰", "â™Š", "â™‹", "â™Œ", "â™", "â™", "â™", "â™",
                "â™‘", "â™’", "â™“", "ğŸ†”", "âš›ï¸", "ğŸ‰‘", "â˜¢ï¸", "â˜£ï¸",
                "ğŸ“´", "ğŸ“³", "ğŸˆ¶", "ğŸˆš", "ğŸˆ¸", "ğŸˆº", "ğŸˆ·ï¸", "âœ´ï¸"
            };
            
            // Ø¯Ø³ØªÙ‡ Ø§Ø´ÛŒØ§Ø¡
            emojiCategories["Ø§Ø´ÛŒØ§Ø¡"] = new List<string>()
            {
                "âŒš", "ğŸ“±", "ğŸ’»", "âŒ¨ï¸", "ğŸ–¥ï¸", "ğŸ–¨ï¸", "ğŸ–±ï¸", "ğŸ–²ï¸",
                "ğŸ’½", "ğŸ’¾", "ğŸ’¿", "ğŸ“€", "ğŸ“¼", "ğŸ“·", "ğŸ“¸", "ğŸ“¹",
                "ğŸ¥", "ğŸ“½ï¸", "ğŸï¸", "ğŸ“", "â˜ï¸", "ğŸ“Ÿ", "ğŸ“ ", "ğŸ“º",
                "ğŸ“»", "ğŸ™ï¸", "ğŸšï¸", "ğŸ›ï¸", "ğŸ§­", "â±ï¸", "â²ï¸", "â°",
                "ğŸ•°ï¸", "âŒ›", "â³", "ğŸ“¡", "ğŸ”‹", "ğŸ”Œ", "ğŸ’¡", "ğŸ”¦",
                "ğŸ•¯ï¸", "ğŸ§¯", "ğŸ›¢ï¸", "ğŸ’¸", "ğŸ’µ", "ğŸ’´", "ğŸ’¶", "ğŸ’·",
                "ğŸ’°", "ğŸ’³", "ğŸ’", "âš–ï¸", "ğŸ§°", "ğŸ”§", "ğŸ”¨", "âš’ï¸"
            };
        }

        private void SetupControls()
        {
            // Search TextBox
            txtSearch = new TextBox
            {
                Location = new Point(10, 10),
                Size = new Size(380, 25),
                Font = new Font("Segoe UI", 10),
                PlaceholderText = "Ø¬Ø³ØªØ¬ÙˆÛŒ Ø§Ù…ÙˆØ¬ÛŒ..."
            };
            txtSearch.TextChanged += TxtSearch_TextChanged;
            this.Controls.Add(txtSearch);

            // Favorites Panel
            favoriteEmojisPanel = new FlowLayoutPanel
            {
                Location = new Point(10, 45),
                Size = new Size(380, 50),
                BorderStyle = BorderStyle.FixedSingle,
                FlowDirection = FlowDirection.RightToLeft
            };
            this.Controls.Add(favoriteEmojisPanel);
            UpdateFavoriteEmojisPanel();

            // Tab Control
            tabEmojiCategories = new TabControl
            {
                Location = new Point(10, 105),
                Size = new Size(380, 385),
                Font = new Font("Segoe UI", 9)
            };
            this.Controls.Add(tabEmojiCategories);

            // Create tabs for each category
            foreach (var category in emojiCategories)
            {
                TabPage tabPage = new TabPage(category.Key);
                tabPage.RightToLeft = RightToLeft.Yes;

                FlowLayoutPanel flowPanel = new FlowLayoutPanel
                {
                    Dock = DockStyle.Fill,
                    AutoScroll = true,
                    FlowDirection = FlowDirection.RightToLeft
                };

                foreach (var emoji in category.Value)
                {
                    Button btnEmoji = CreateEmojiButton(emoji);
                    flowPanel.Controls.Add(btnEmoji);
                }

                tabPage.Controls.Add(flowPanel);
                tabEmojiCategories.TabPages.Add(tabPage);
            }

            // Add close button
            Button btnClose = new Button
            {
                Text = "Ã—",
                Size = new Size(25, 25),
                Location = new Point(365, 5),
                FlatStyle = FlatStyle.Flat,
                Font = new Font("Segoe UI", 12, FontStyle.Bold)
            };
            btnClose.Click += (s, e) => this.Hide();
            this.Controls.Add(btnClose);
        }

        private Button CreateEmojiButton(string emoji)
        {
            Button btnEmoji = new Button
            {
                Text = emoji,
                Size = new Size(40, 40),
                Margin = new Padding(3),
                Font = new Font("Segoe UI", 12),
                FlatStyle = FlatStyle.Flat,
                UseVisualStyleBackColor = true
            };

            ContextMenuStrip contextMenu = new ContextMenuStrip();
            ToolStripMenuItem addToFavoritesItem = new ToolStripMenuItem("Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ù¾Ø±Ú©Ø§Ø±Ø¨Ø±Ø¯Ù‡Ø§");
            addToFavoritesItem.Click += (sender, e) => AddToFavorites(emoji);
            contextMenu.Items.Add(addToFavoritesItem);

            if (favoriteEmojis.Contains(emoji))
            {
                ToolStripMenuItem removeFromFavoritesItem = new ToolStripMenuItem("Ø­Ø°Ù Ø§Ø² Ù¾Ø±Ú©Ø§Ø±Ø¨Ø±Ø¯Ù‡Ø§");
                removeFromFavoritesItem.Click += (sender, e) => RemoveFromFavorites(emoji);
                contextMenu.Items.Add(removeFromFavoritesItem);
            }

            btnEmoji.ContextMenuStrip = contextMenu;
            btnEmoji.Click += (sender, e) => EmojiSelected?.Invoke(emoji);

            return btnEmoji;
        }

        private void AddToFavorites(string emoji)
        {
            if (!favoriteEmojis.Contains(emoji))
            {
                favoriteEmojis.Add(emoji);
                if (favoriteEmojis.Count > 20)
                    favoriteEmojis.RemoveAt(0);
                UpdateFavoriteEmojisPanel();
                FavoriteEmojisChanged?.Invoke(favoriteEmojis);
            }
        }

        private void RemoveFromFavorites(string emoji)
        {
            if (favoriteEmojis.Contains(emoji))
            {
                favoriteEmojis.Remove(emoji);
                UpdateFavoriteEmojisPanel();
                FavoriteEmojisChanged?.Invoke(favoriteEmojis);
            }
        }

        private void UpdateFavoriteEmojisPanel()
        {
            favoriteEmojisPanel.Controls.Clear();

            Label lblTitle = new Label
            {
                Text = "Ù¾Ø±Ú©Ø§Ø±Ø¨Ø±Ø¯Ù‡Ø§:",
                AutoSize = true,
                Margin = new Padding(3, 10, 3, 10),
                Font = new Font("Segoe UI", 9)
            };
            favoriteEmojisPanel.Controls.Add(lblTitle);

            foreach (var emoji in favoriteEmojis)
            {
                Button btnEmoji = new Button
                {
                    Text = emoji,
                    Size = new Size(35, 35),
                    Margin = new Padding(2),
                    Font = new Font("Segoe UI", 12),
                    FlatStyle = FlatStyle.Flat,
                    UseVisualStyleBackColor = true
                };

                btnEmoji.Click += (sender, e) => EmojiSelected?.Invoke(emoji);
                favoriteEmojisPanel.Controls.Add(btnEmoji);
            }
        }

        private void TxtSearch_TextChanged(object sender, EventArgs e)
        {
            string searchText = txtSearch.Text.Trim().ToLower();
            
            if (string.IsNullOrEmpty(searchText) || searchText == "Ø¬Ø³ØªØ¬ÙˆÛŒ Ø§Ù…ÙˆØ¬ÛŒ...")
            {
                tabEmojiCategories.Visible = true;
                return;
            }

            TabPage searchResultTab = null;
            foreach (TabPage tab in tabEmojiCategories.TabPages)
            {
                if (tab.Text == "Ù†ØªØ§ÛŒØ¬ Ø¬Ø³ØªØ¬Ùˆ")
                {
                    searchResultTab = tab;
                    searchResultTab.Controls.Clear();
                    break;
                }
            }

            if (searchResultTab == null)
            {
                searchResultTab = new TabPage("Ù†ØªØ§ÛŒØ¬ Ø¬Ø³ØªØ¬Ùˆ");
                tabEmojiCategories.TabPages.Add(searchResultTab);
            }

            FlowLayoutPanel flowPanel = new FlowLayoutPanel
            {
                Dock = DockStyle.Fill,
                AutoScroll = true,
                FlowDirection = FlowDirection.RightToLeft
            };

            var searchResults = new List<string>();
            foreach (var category in emojiCategories)
            {
                foreach (var emoji in category.Value)
                {
                    if (emoji.Contains(searchText))
                    {
                        searchResults.Add(emoji);
                    }
                }
            }

            foreach (var emoji in searchResults)
            {
                Button btnEmoji = CreateEmojiButton(emoji);
                flowPanel.Controls.Add(btnEmoji);
            }

            searchResultTab.Controls.Add(flowPanel);
            tabEmojiCategories.SelectedTab = searchResultTab;
        }

        protected override void OnDeactivate(EventArgs e)
        {
            base.OnDeactivate(e);
            this.Hide();
        }
    }
}


=================================================================================

using System;
using System.Collections.Generic;
using System.Drawing;
using System.Linq;
using System.Windows.Forms;

namespace EmojiSelectorApp
{
    public class EmojiPopupForm : Form
    {
        private TextBox txtSearch;
        private TabControl tabEmojiCategories;
        private FlowLayoutPanel favoriteEmojisPanel;
        private List<string> favoriteEmojis;
        private Dictionary<string, List<string>> emojiCategories;
        private MainForm parentForm;

        public event Action<string> EmojiSelected;
        public event Action<List<string>> FavoriteEmojisChanged;

        public EmojiPopupForm(MainForm parent)
        {
            parentForm = parent;
            InitializePopup();
            InitializeEmojiCategories();
            LoadFavoriteEmojis();
            SetupControls();
        }

        private void InitializePopup()
        {
            this.FormBorderStyle = FormBorderStyle.None;
            this.Size = new Size(400, 500);
            this.ShowInTaskbar = false;
            this.TopMost = true;
            this.StartPosition = FormStartPosition.Manual;
            this.RightToLeft = RightToLeft.Yes;
            this.BackColor = Color.White;
            this.Paint += (s, e) => 
            {
                e.Graphics.DrawRectangle(new Pen(Color.LightGray), 0, 0, Width - 1, Height - 1);
            };
        }

        private void LoadFavoriteEmojis()
        {
            favoriteEmojis = parentForm.favoriteEmojis;
        }

        private void InitializeEmojiCategories()
        {
            emojiCategories = new Dictionary<string, List<string>>();
            
            // Ø¯Ø³ØªÙ‡ Ø§Ø­Ø³Ø§Ø³Ø§Øª Ùˆ ØµÙˆØ±Øªâ€ŒÙ‡Ø§
            emojiCategories["Ø§Ø­Ø³Ø§Ø³Ø§Øª"] = new List<string>()
            {
                "ğŸ˜€", "ğŸ˜", "ğŸ˜‚", "ğŸ¤£", "ğŸ˜ƒ", "ğŸ˜„", "ğŸ˜…", "ğŸ˜†",
                "ğŸ˜‰", "ğŸ˜Š", "ğŸ˜‹", "ğŸ˜", "ğŸ˜", "ğŸ˜˜", "ğŸ¥°", "ğŸ˜—",
                "ğŸ˜™", "ğŸ˜š", "ğŸ™‚", "ğŸ¤—", "ğŸ¤©", "ğŸ¤”", "ğŸ¤¨", "ğŸ˜",
                "ğŸ˜‘", "ğŸ˜¶", "ğŸ™„", "ğŸ˜", "ğŸ˜£", "ğŸ˜¥", "ğŸ˜®", "ğŸ¤",
                "ğŸ˜¯", "ğŸ˜ª", "ğŸ˜«", "ğŸ¥±", "ğŸ˜´", "ğŸ˜Œ", "ğŸ˜›", "ğŸ˜œ",
                "ğŸ˜", "ğŸ¤¤", "ğŸ˜’", "ğŸ˜“", "ğŸ˜”", "ğŸ˜•", "ğŸ™ƒ", "ğŸ¤‘",
                "ğŸ˜²", "â˜¹ï¸", "ğŸ™", "ğŸ˜–", "ğŸ˜", "ğŸ˜Ÿ", "ğŸ˜¤", "ğŸ˜¢",
                "ğŸ˜­", "ğŸ˜¦", "ğŸ˜§", "ğŸ˜¨", "ğŸ˜©", "ğŸ¤¯", "ğŸ˜¬", "ğŸ˜°"
            };
            
            // Ø¯Ø³ØªÙ‡ Ø­ÛŒÙˆØ§Ù†Ø§Øª
            emojiCategories["Ø­ÛŒÙˆØ§Ù†Ø§Øª"] = new List<string>()
            {
                "ğŸ¶", "ğŸ±", "ğŸ­", "ğŸ¹", "ğŸ°", "ğŸ¦Š", "ğŸ»", "ğŸ¼",
                "ğŸ¨", "ğŸ¯", "ğŸ¦", "ğŸ®", "ğŸ·", "ğŸ¸", "ğŸµ", "ğŸ”",
                "ğŸ§", "ğŸ¦", "ğŸ¤", "ğŸ¦†", "ğŸ¦…", "ğŸ¦‰", "ğŸ¦‡", "ğŸº",
                "ğŸ—", "ğŸ´", "ğŸ¦„", "ğŸ", "ğŸ›", "ğŸ¦‹", "ğŸŒ", "ğŸ",
                "ğŸœ", "ğŸ¦Ÿ", "ğŸ¦—", "ğŸ•·ï¸", "ğŸ¦‚", "ğŸ¢", "ğŸ", "ğŸ¦",
                "ğŸ¦–", "ğŸ¦•", "ğŸ™", "ğŸ¦‘", "ğŸ¦", "ğŸ¦", "ğŸ¦€", "ğŸ¡",
                "ğŸ ", "ğŸŸ", "ğŸ¬", "ğŸ³", "ğŸ‹", "ğŸ¦ˆ", "ğŸŠ", "ğŸ…"
            };
            
            // Ø¯Ø³ØªÙ‡ ØºØ°Ø§Ù‡Ø§
            emojiCategories["ØºØ°Ø§Ù‡Ø§"] = new List<string>()
            {
                "ğŸ", "ğŸ", "ğŸ", "ğŸŠ", "ğŸ‹", "ğŸŒ", "ğŸ‰", "ğŸ‡",
                "ğŸ“", "ğŸˆ", "ğŸ’", "ğŸ‘", "ğŸ¥­", "ğŸ", "ğŸ¥¥", "ğŸ¥",
                "ğŸ…", "ğŸ†", "ğŸ¥‘", "ğŸ¥¦", "ğŸ¥¬", "ğŸ¥’", "ğŸŒ¶ï¸", "ğŸŒ½",
                "ğŸ¥•", "ğŸ§„", "ğŸ§…", "ğŸ¥”", "ğŸ ", "ğŸ¥", "ğŸ¥¯", "ğŸ",
                "ğŸ¥–", "ğŸ¥¨", "ğŸ§€", "ğŸ¥š", "ğŸ³", "ğŸ§ˆ", "ğŸ¥", "ğŸ§‡",
                "ğŸ¥“", "ğŸ¥©", "ğŸ—", "ğŸ–", "ğŸŒ­", "ğŸ”", "ğŸŸ", "ğŸ•",
                "ğŸ¥ª", "ğŸ¥™", "ğŸ§†", "ğŸŒ®", "ğŸŒ¯", "ğŸ¥—", "ğŸ¥˜", "ğŸ¥«"
            };
            
            // Ø¯Ø³ØªÙ‡ Ø¹Ù„Ø§Ø¦Ù… Ùˆ Ù†Ù…Ø§Ø¯Ù‡Ø§
            emojiCategories["Ù†Ù…Ø§Ø¯Ù‡Ø§"] = new List<string>()
            {
                "â¤ï¸", "ğŸ§¡", "ğŸ’›", "ğŸ’š", "ğŸ’™", "ğŸ’œ", "ğŸ–¤", "ğŸ¤",
                "ğŸ¤", "ğŸ’”", "â£ï¸", "ğŸ’•", "ğŸ’", "ğŸ’“", "ğŸ’—", "ğŸ’–",
                "ğŸ’˜", "ğŸ’", "ğŸ’Ÿ", "â˜®ï¸", "âœï¸", "â˜ªï¸", "ğŸ•‰ï¸", "â˜¸ï¸",
                "âœ¡ï¸", "ğŸ”¯", "ğŸ•", "â˜¯ï¸", "â˜¦ï¸", "ğŸ›", "â›", "â™ˆ",
                "â™‰", "â™Š", "â™‹", "â™Œ", "â™", "â™", "â™", "â™",
                "â™‘", "â™’", "â™“", "ğŸ†”", "âš›ï¸", "ğŸ‰‘", "â˜¢ï¸", "â˜£ï¸",
                "ğŸ“´", "ğŸ“³", "ğŸˆ¶", "ğŸˆš", "ğŸˆ¸", "ğŸˆº", "ğŸˆ·ï¸", "âœ´ï¸"
            };
            
            // Ø¯Ø³ØªÙ‡ Ø§Ø´ÛŒØ§Ø¡
            emojiCategories["Ø§Ø´ÛŒØ§Ø¡"] = new List<string>()
            {
                "âŒš", "ğŸ“±", "ğŸ’»", "âŒ¨ï¸", "ğŸ–¥ï¸", "ğŸ–¨ï¸", "ğŸ–±ï¸", "ğŸ–²ï¸",
                "ğŸ’½", "ğŸ’¾", "ğŸ’¿", "ğŸ“€", "ğŸ“¼", "ğŸ“·", "ğŸ“¸", "ğŸ“¹",
                "ğŸ¥", "ğŸ“½ï¸", "ğŸï¸", "ğŸ“", "â˜ï¸", "ğŸ“Ÿ", "ğŸ“ ", "ğŸ“º",
                "ğŸ“»", "ğŸ™ï¸", "ğŸšï¸", "ğŸ›ï¸", "ğŸ§­", "â±ï¸", "â²ï¸", "â°",
                "ğŸ•°ï¸", "âŒ›", "â³", "ğŸ“¡", "ğŸ”‹", "ğŸ”Œ", "ğŸ’¡", "ğŸ”¦",
                "ğŸ•¯ï¸", "ğŸ§¯", "ğŸ›¢ï¸", "ğŸ’¸", "ğŸ’µ", "ğŸ’´", "ğŸ’¶", "ğŸ’·",
                "ğŸ’°", "ğŸ’³", "ğŸ’", "âš–ï¸", "ğŸ§°", "ğŸ”§", "ğŸ”¨", "âš’ï¸"
            };
        }

        private void SetupControls()
        {
            // Search TextBox
            txtSearch = new TextBox
            {
                Location = new Point(10, 10),
                Size = new Size(380, 25),
                Font = new Font("Segoe UI", 10),
                PlaceholderText = "Ø¬Ø³ØªØ¬ÙˆÛŒ Ø§Ù…ÙˆØ¬ÛŒ..."
            };
            txtSearch.TextChanged += TxtSearch_TextChanged;
            this.Controls.Add(txtSearch);

            // Favorites Panel
            favoriteEmojisPanel = new FlowLayoutPanel
            {
                Location = new Point(10, 45),
                Size = new Size(380, 50),
                BorderStyle = BorderStyle.FixedSingle,
                FlowDirection = FlowDirection.RightToLeft
            };
            this.Controls.Add(favoriteEmojisPanel);
            UpdateFavoriteEmojisPanel();

            // Tab Control
            tabEmojiCategories = new TabControl
            {
                Location = new Point(10, 105),
                Size = new Size(380, 385),
                Font = new Font("Segoe UI", 9)
            };
            this.Controls.Add(tabEmojiCategories);

            // Create tabs for each category
            foreach (var category in emojiCategories)
            {
                TabPage tabPage = new TabPage(category.Key);
                tabPage.RightToLeft = RightToLeft.Yes;

                FlowLayoutPanel flowPanel = new FlowLayoutPanel
                {
                    Dock = DockStyle.Fill,
                    AutoScroll = true,
                    FlowDirection = FlowDirection.RightToLeft
                };

                foreach (var emoji in category.Value)
                {
                    Button btnEmoji = CreateEmojiButton(emoji);
                    flowPanel.Controls.Add(btnEmoji);
                }

                tabPage.Controls.Add(flowPanel);
                tabEmojiCategories.TabPages.Add(tabPage);
            }

            // Add close button
            Button btnClose = new Button
            {
                Text = "Ã—",
                Size = new Size(25, 25),
                Location = new Point(365, 5),
                FlatStyle = FlatStyle.Flat,
                Font = new Font("Segoe UI", 12, FontStyle.Bold)
            };
            btnClose.Click += (s, e) => this.Hide();
            this.Controls.Add(btnClose);
        }

        private Button CreateEmojiButton(string emoji)
        {
            Button btnEmoji = new Button
            {
                Text = emoji,
                Size = new Size(40, 40),
                Margin = new Padding(3),
                Font = new Font("Segoe UI", 12),
                FlatStyle = FlatStyle.Flat,
                UseVisualStyleBackColor = true
            };

            ContextMenuStrip contextMenu = new ContextMenuStrip();
            ToolStripMenuItem addToFavoritesItem = new ToolStripMenuItem("Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ù¾Ø±Ú©Ø§Ø±Ø¨Ø±Ø¯Ù‡Ø§");
            addToFavoritesItem.Click += (sender, e) => AddToFavorites(emoji);
            contextMenu.Items.Add(addToFavoritesItem);

            if (favoriteEmojis.Contains(emoji))
            {
                ToolStripMenuItem removeFromFavoritesItem = new ToolStripMenuItem("Ø­Ø°Ù Ø§Ø² Ù¾Ø±Ú©Ø§Ø±Ø¨Ø±Ø¯Ù‡Ø§");
                removeFromFavoritesItem.Click += (sender, e) => RemoveFromFavorites(emoji);
                contextMenu.Items.Add(removeFromFavoritesItem);
            }

            btnEmoji.ContextMenuStrip = contextMenu;
            btnEmoji.Click += (sender, e) => EmojiSelected?.Invoke(emoji);

            return btnEmoji;
        }

        private void AddToFavorites(string emoji)
        {
            if (!favoriteEmojis.Contains(emoji))
            {
                favoriteEmojis.Add(emoji);
                if (favoriteEmojis.Count > 20)
                    favoriteEmojis.RemoveAt(0);
                UpdateFavoriteEmojisPanel();
                FavoriteEmojisChanged?.Invoke(favoriteEmojis);
            }
        }

        private void RemoveFromFavorites(string emoji)
        {
            if (favoriteEmojis.Contains(emoji))
            {
                favoriteEmojis.Remove(emoji);
                UpdateFavoriteEmojisPanel();
                FavoriteEmojisChanged?.Invoke(favoriteEmojis);
            }
        }

        private void UpdateFavoriteEmojisPanel()
        {
            favoriteEmojisPanel.Controls.Clear();

            Label lblTitle = new Label
            {
                Text = "Ù¾Ø±Ú©Ø§Ø±Ø¨Ø±Ø¯Ù‡Ø§:",
                AutoSize = true,
                Margin = new Padding(3, 10, 3, 10),
                Font = new Font("Segoe UI", 9)
            };
            favoriteEmojisPanel.Controls.Add(lblTitle);

            foreach (var emoji in favoriteEmojis)
            {
                Button btnEmoji = new Button
                {
                    Text = emoji,
                    Size = new Size(35, 35),
                    Margin = new Padding(2),
                    Font = new Font("Segoe UI", 12),
                    FlatStyle = FlatStyle.Flat,
                    UseVisualStyleBackColor = true
                };

                btnEmoji.Click += (sender, e) => EmojiSelected?.Invoke(emoji);
                favoriteEmojisPanel.Controls.Add(btnEmoji);
            }
        }

        private void TxtSearch_TextChanged(object sender, EventArgs e)
        {
            string searchText = txtSearch.Text.Trim().ToLower();
            
            if (string.IsNullOrEmpty(searchText) || searchText == "Ø¬Ø³ØªØ¬ÙˆÛŒ Ø§Ù…ÙˆØ¬ÛŒ...")
            {
                tabEmojiCategories.Visible = true;
                return;
            }

            TabPage searchResultTab = null;
            foreach (TabPage tab in tabEmojiCategories.TabPages)
            {
                if (tab.Text == "Ù†ØªØ§ÛŒØ¬ Ø¬Ø³ØªØ¬Ùˆ")
                {
                    searchResultTab = tab;
                    searchResultTab.Controls.Clear();
                    break;
                }
            }

            if (searchResultTab == null)
            {
                searchResultTab = new TabPage("Ù†ØªØ§ÛŒØ¬ Ø¬Ø³ØªØ¬Ùˆ");
                tabEmojiCategories.TabPages.Add(searchResultTab);
            }

            FlowLayoutPanel flowPanel = new FlowLayoutPanel
            {
                Dock = DockStyle.Fill,
                AutoScroll = true,
                FlowDirection = FlowDirection.RightToLeft
            };

            var searchResults = new List<string>();
            foreach (var category in emojiCategories)
            {
                foreach (var emoji in category.Value)
                {
                    if (emoji.Contains(searchText))
                    {
                        searchResults.Add(emoji);
                    }
                }
            }

            foreach (var emoji in searchResults)
            {
                Button btnEmoji = CreateEmojiButton(emoji);
                flowPanel.Controls.Add(btnEmoji);
            }

            searchResultTab.Controls.Add(flowPanel);
            tabEmojiCategories.SelectedTab = searchResultTab;
        }

        protected override void OnDeactivate(EventArgs e)
        {
            base.OnDeactivate(e);
            this.Hide();
        }
    }
} 
