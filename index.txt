using System;
using System.Collections.Generic;
using System.Drawing;
using System.Linq;
using System.Windows.Forms;

namespace EmojiSelectorApp
{
    public partial class MainForm : Form
    {
        private TextBox txtMessage;
        private Button btnEmoji;
        private Panel emojiPanel;
        private TabControl tabEmojiCategories;
        private TextBox txtSearch;
        private FlowLayoutPanel favoriteEmojisPanel;
        private List<string> favoriteEmojis;
        
        // Ø¯ÛŒÚ©Ø´Ù†Ø±ÛŒ Ø¨Ø±Ø§ÛŒ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø§Ù…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§
        private Dictionary<string, List<string>> emojiCategories;

        public MainForm()
        {
            InitializeComponent();
            InitializeEmojiCategories();
            LoadFavoriteEmojis();
            SetupControls();
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ú©Ù„ÛŒØ¯ Ù…ÛŒØ§Ù†Ø¨Ø± (Ctrl+E) Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´/Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ù¾Ù†Ù„ Ø§Ù…ÙˆØ¬ÛŒ
            this.KeyPreview = true;
            this.KeyDown += MainForm_KeyDown;
        }

        private void MainForm_KeyDown(object sender, KeyEventArgs e)
        {
            // Ù…ÛŒØ§Ù†Ø¨Ø± Ctrl+E Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´/Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ù¾Ù†Ù„ Ø§Ù…ÙˆØ¬ÛŒ
            if (e.Control && e.KeyCode == Keys.E)
            {
                e.SuppressKeyPress = true;
                emojiPanel.Visible = !emojiPanel.Visible;
                if (emojiPanel.Visible)
                    txtSearch.Focus();
            }
        }

        private void InitializeEmojiCategories()
        {
            // Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù Ø§Ù…ÙˆØ¬ÛŒ
            emojiCategories = new Dictionary<string, List<string>>();
            
            // Ø¯Ø³ØªÙ‡ Ø§Ø­Ø³Ø§Ø³Ø§Øª Ùˆ ØµÙˆØ±Øªâ€ŒÙ‡Ø§
            emojiCategories["Ø§Ø­Ø³Ø§Ø³Ø§Øª"] = new List<string>()
            {
                "ğŸ˜€", "ğŸ˜", "ğŸ˜‚", "ğŸ¤£", "ğŸ˜ƒ", "ğŸ˜„", "ğŸ˜…", "ğŸ˜†",
                "ğŸ˜‰", "ğŸ˜Š", "ğŸ˜‹", "ğŸ˜", "ğŸ˜", "ğŸ˜˜", "ğŸ¥°", "ğŸ˜—",
                "ğŸ˜™", "ğŸ˜š", "ğŸ™‚", "ğŸ¤—", "ğŸ¤©", "ğŸ¤”", "ğŸ¤¨", "ğŸ˜",
                "ğŸ˜‘", "ğŸ˜¶", "ğŸ™„", "ğŸ˜", "ğŸ˜£", "ğŸ˜¥", "ğŸ˜®", "ğŸ¤",
                "ğŸ˜¯", "ğŸ˜ª", "ğŸ˜«", "ğŸ¥±", "ğŸ˜´", "ğŸ˜Œ", "ğŸ˜›", "ğŸ˜œ",
                "ğŸ˜", "ğŸ¤¤", "ğŸ˜’", "ğŸ˜“", "ğŸ˜”", "ğŸ˜•", "ğŸ™ƒ", "ğŸ¤‘",
                "ğŸ˜²", "â˜¹ï¸", "ğŸ™", "ğŸ˜–", "ğŸ˜", "ğŸ˜Ÿ", "ğŸ˜¤", "ğŸ˜¢",
                "ğŸ˜­", "ğŸ˜¦", "ğŸ˜§", "ğŸ˜¨", "ğŸ˜©", "ğŸ¤¯", "ğŸ˜¬", "ğŸ˜°"
            };
            
            // Ø¯Ø³ØªÙ‡ Ø­ÛŒÙˆØ§Ù†Ø§Øª
            emojiCategories["Ø­ÛŒÙˆØ§Ù†Ø§Øª"] = new List<string>()
            {
                "ğŸ¶", "ğŸ±", "ğŸ­", "ğŸ¹", "ğŸ°", "ğŸ¦Š", "ğŸ»", "ğŸ¼",
                "ğŸ¨", "ğŸ¯", "ğŸ¦", "ğŸ®", "ğŸ·", "ğŸ¸", "ğŸµ", "ğŸ”",
                "ğŸ§", "ğŸ¦", "ğŸ¤", "ğŸ¦†", "ğŸ¦…", "ğŸ¦‰", "ğŸ¦‡", "ğŸº",
                "ğŸ—", "ğŸ´", "ğŸ¦„", "ğŸ", "ğŸ›", "ğŸ¦‹", "ğŸŒ", "ğŸ",
                "ğŸœ", "ğŸ¦Ÿ", "ğŸ¦—", "ğŸ•·ï¸", "ğŸ¦‚", "ğŸ¢", "ğŸ", "ğŸ¦",
                "ğŸ¦–", "ğŸ¦•", "ğŸ™", "ğŸ¦‘", "ğŸ¦", "ğŸ¦", "ğŸ¦€", "ğŸ¡",
                "ğŸ ", "ğŸŸ", "ğŸ¬", "ğŸ³", "ğŸ‹", "ğŸ¦ˆ", "ğŸŠ", "ğŸ…"
            };
            
            // Ø¯Ø³ØªÙ‡ ØºØ°Ø§Ù‡Ø§
            emojiCategories["ØºØ°Ø§Ù‡Ø§"] = new List<string>()
            {
                "ğŸ", "ğŸ", "ğŸ", "ğŸŠ", "ğŸ‹", "ğŸŒ", "ğŸ‰", "ğŸ‡",
                "ğŸ“", "ğŸˆ", "ğŸ’", "ğŸ‘", "ğŸ¥­", "ğŸ", "ğŸ¥¥", "ğŸ¥",
                "ğŸ…", "ğŸ†", "ğŸ¥‘", "ğŸ¥¦", "ğŸ¥¬", "ğŸ¥’", "ğŸŒ¶ï¸", "ğŸŒ½",
                "ğŸ¥•", "ğŸ§„", "ğŸ§…", "ğŸ¥”", "ğŸ ", "ğŸ¥", "ğŸ¥¯", "ğŸ",
                "ğŸ¥–", "ğŸ¥¨", "ğŸ§€", "ğŸ¥š", "ğŸ³", "ğŸ§ˆ", "ğŸ¥", "ğŸ§‡",
                "ğŸ¥“", "ğŸ¥©", "ğŸ—", "ğŸ–", "ğŸŒ­", "ğŸ”", "ğŸŸ", "ğŸ•",
                "ğŸ¥ª", "ğŸ¥™", "ğŸ§†", "ğŸŒ®", "ğŸŒ¯", "ğŸ¥—", "ğŸ¥˜", "ğŸ¥«"
            };
            
            // Ø¯Ø³ØªÙ‡ Ø¹Ù„Ø§Ø¦Ù… Ùˆ Ù†Ù…Ø§Ø¯Ù‡Ø§
            emojiCategories["Ù†Ù…Ø§Ø¯Ù‡Ø§"] = new List<string>()
            {
                "â¤ï¸", "ğŸ§¡", "ğŸ’›", "ğŸ’š", "ğŸ’™", "ğŸ’œ", "ğŸ–¤", "ğŸ¤",
                "ğŸ¤", "ğŸ’”", "â£ï¸", "ğŸ’•", "ğŸ’", "ğŸ’“", "ğŸ’—", "ğŸ’–",
                "ğŸ’˜", "ğŸ’", "ğŸ’Ÿ", "â˜®ï¸", "âœï¸", "â˜ªï¸", "ğŸ•‰ï¸", "â˜¸ï¸",
                "âœ¡ï¸", "ğŸ”¯", "ğŸ•", "â˜¯ï¸", "â˜¦ï¸", "ğŸ›", "â›", "â™ˆ",
                "â™‰", "â™Š", "â™‹", "â™Œ", "â™", "â™", "â™", "â™",
                "â™‘", "â™’", "â™“", "ğŸ†”", "âš›ï¸", "ğŸ‰‘", "â˜¢ï¸", "â˜£ï¸",
                "ğŸ“´", "ğŸ“³", "ğŸˆ¶", "ğŸˆš", "ğŸˆ¸", "ğŸˆº", "ğŸˆ·ï¸", "âœ´ï¸"
            };
            
            // Ø¯Ø³ØªÙ‡ Ø§Ø´ÛŒØ§Ø¡
            emojiCategories["Ø§Ø´ÛŒØ§Ø¡"] = new List<string>()
            {
                "âŒš", "ğŸ“±", "ğŸ’»", "âŒ¨ï¸", "ğŸ–¥ï¸", "ğŸ–¨ï¸", "ğŸ–±ï¸", "ğŸ–²ï¸",
                "ğŸ’½", "ğŸ’¾", "ğŸ’¿", "ğŸ“€", "ğŸ“¼", "ğŸ“·", "ğŸ“¸", "ğŸ“¹",
                "ğŸ¥", "ğŸ“½ï¸", "ğŸï¸", "ğŸ“", "â˜ï¸", "ğŸ“Ÿ", "ğŸ“ ", "ğŸ“º",
                "ğŸ“»", "ğŸ™ï¸", "ğŸšï¸", "ğŸ›ï¸", "ğŸ§­", "â±ï¸", "â²ï¸", "â°",
                "ğŸ•°ï¸", "âŒ›", "â³", "ğŸ“¡", "ğŸ”‹", "ğŸ”Œ", "ğŸ’¡", "ğŸ”¦",
                "ğŸ•¯ï¸", "ğŸ§¯", "ğŸ›¢ï¸", "ğŸ’¸", "ğŸ’µ", "ğŸ’´", "ğŸ’¶", "ğŸ’·",
                "ğŸ’°", "ğŸ’³", "ğŸ’", "âš–ï¸", "ğŸ§°", "ğŸ”§", "ğŸ”¨", "âš’ï¸"
            };
            
            // Ø§Ù…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ú©Ø§Ø±Ø¨Ø±Ø¯ Ø§ÙˆÙ„ÛŒÙ‡
            favoriteEmojis = new List<string>() { "ğŸ‘", "ğŸ‘‹", "â¤ï¸", "ğŸ˜‚", "ğŸ™", "ğŸ‘", "ğŸ”¥", "ğŸ‰" };
        }

        private void LoadFavoriteEmojis()
        {
            // Ø¯Ø± Ù†Ø³Ø®Ù‡ ÙˆØ§Ù‚Ø¹ÛŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ù…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ú©Ø§Ø±Ø¨Ø±Ø¯ Ø±Ø§ Ø§Ø² ÙØ§ÛŒÙ„ ÛŒØ§ Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø¨Ø®ÙˆØ§Ù†ÛŒØ¯
            // Ø§ÛŒÙ† Ù‚Ø³Ù…Øª Ø±Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù† Ø¨Ø§ Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ú©Ø±Ø¯
        }

        private void SaveFavoriteEmoji(string emoji)
        {
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ù„ÛŒØ³Øª Ù¾Ø±Ú©Ø§Ø±Ø¨Ø±Ø¯Ù‡Ø§ Ø§Ú¯Ø± Ù‚Ø¨Ù„Ø§Ù‹ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯
            if (!favoriteEmojis.Contains(emoji))
            {
                favoriteEmojis.Add(emoji);
                // Ù…Ø­Ø¯ÙˆØ¯ Ú©Ø±Ø¯Ù† ØªØ¹Ø¯Ø§Ø¯ Ø§Ù…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ú©Ø§Ø±Ø¨Ø±Ø¯ Ø¨Ù‡ 20 Ù…ÙˆØ±Ø¯
                if (favoriteEmojis.Count > 20)
                    favoriteEmojis.RemoveAt(0);
                
                // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù¾Ù†Ù„ Ø§Ù…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ú©Ø§Ø±Ø¨Ø±Ø¯
                UpdateFavoriteEmojisPanel();
                
                // Ø¯Ø± Ù†Ø³Ø®Ù‡ ÙˆØ§Ù‚Ø¹ÛŒØŒ Ø§ÛŒÙ†Ø¬Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ù…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ú©Ø§Ø±Ø¨Ø±Ø¯ Ø±Ø§ Ø¯Ø± ÙØ§ÛŒÙ„ ÛŒØ§ Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†ÛŒØ¯
            }
        }

        private void SetupControls()
        {
            // ØªÙ†Ø¸ÛŒÙ… ÙØ±Ù… Ø§ØµÙ„ÛŒ
            this.Text = "Ù¾ÛŒØ§Ù…â€ŒØ±Ø³Ø§Ù† Ø¨Ø§ Ø§Ù†ØªØ®Ø§Ø¨Ú¯Ø± Ø§Ù…ÙˆØ¬ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡";
            this.Size = new Size(600, 550);
            this.StartPosition = FormStartPosition.CenterScreen;
            this.RightToLeft = RightToLeft.Yes; // Ø¨Ø±Ø§ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² Ø²Ø¨Ø§Ù† ÙØ§Ø±Ø³ÛŒ
            
            // Ø§ÛŒØ¬Ø§Ø¯ TextBox Ø¨Ø±Ø§ÛŒ Ù†ÙˆØ´ØªÙ† Ù¾ÛŒØ§Ù…
            txtMessage = new TextBox
            {
                Multiline = true,
                Location = new Point(10, 10),
                Size = new Size(500, 100),
                Font = new Font("Segoe UI", 12),
                RightToLeft = RightToLeft.Yes,
                ScrollBars = ScrollBars.Vertical
            };
            this.Controls.Add(txtMessage);
            
            // Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ú©Ù…Ù‡ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù¾Ù†Ù„ Ø§Ù…ÙˆØ¬ÛŒ
            btnEmoji = new Button
            {
                Text = "ğŸ˜Š",
                Location = new Point(520, 10),
                Size = new Size(50, 50),
                Font = new Font("Segoe UI", 16)
            };
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† ØªÙˆÙ„ØªÛŒÙ¾ Ø¨Ù‡ Ø¯Ú©Ù…Ù‡ Ø§Ù…ÙˆØ¬ÛŒ
            ToolTip emojiButtonTooltip = new ToolTip();
            emojiButtonTooltip.SetToolTip(btnEmoji, "Ù†Ù…Ø§ÛŒØ´ Ø§Ù…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ (Ctrl+E)");
            btnEmoji.Click += BtnEmoji_Click;
            this.Controls.Add(btnEmoji);
            
            // Ø§ÛŒØ¬Ø§Ø¯ Ù¾Ù†Ù„ Ø§ØµÙ„ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø§Ù…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§
            emojiPanel = new Panel
            {
                Location = new Point(10, 120),
                Size = new Size(560, 350),
                BorderStyle = BorderStyle.FixedSingle,
                Visible = false
            };
            this.Controls.Add(emojiPanel);
            
            // Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ø¯Ø± Ø¬Ø³ØªØ¬Ùˆ Ø¨Ø±Ø§ÛŒ Ø§Ù…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§
            txtSearch = new TextBox
            {
                Location = new Point(10, 10),
                Size = new Size(540, 25),
                Font = new Font("Segoe UI", 10)
            };
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù…ØªÙ† Ø±Ø§Ù‡Ù†Ù…Ø§ (Placeholder) Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø±ÙˆÛŒØ¯Ø§Ø¯
            txtSearch.Text = "Ø¬Ø³ØªØ¬ÙˆÛŒ Ø§Ù…ÙˆØ¬ÛŒ...";
            txtSearch.ForeColor = Color.Gray;
            txtSearch.GotFocus += (s, e) => 
            {
                if (txtSearch.Text == "Ø¬Ø³ØªØ¬ÙˆÛŒ Ø§Ù…ÙˆØ¬ÛŒ...")
                {
                    txtSearch.Text = "";
                    txtSearch.ForeColor = Color.Black;
                }
            };
            txtSearch.LostFocus += (s, e) => 
            {
                if (string.IsNullOrWhiteSpace(txtSearch.Text))
                {
                    txtSearch.Text = "Ø¬Ø³ØªØ¬ÙˆÛŒ Ø§Ù…ÙˆØ¬ÛŒ...";
                    txtSearch.ForeColor = Color.Gray;
                }
            };
            txtSearch.TextChanged += TxtSearch_TextChanged;
            emojiPanel.Controls.Add(txtSearch);
            
            // Ø§ÛŒØ¬Ø§Ø¯ Ù¾Ù†Ù„ Ø¨Ø±Ø§ÛŒ Ø§Ù…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ú©Ø§Ø±Ø¨Ø±Ø¯
            favoriteEmojisPanel = new FlowLayoutPanel
            {
                Location = new Point(10, 45),
                Size = new Size(540, 50),
                BorderStyle = BorderStyle.FixedSingle,
                FlowDirection = FlowDirection.LeftToRight
            };
            emojiPanel.Controls.Add(favoriteEmojisPanel);
            UpdateFavoriteEmojisPanel();
            
            // Ø§ÛŒØ¬Ø§Ø¯ ØªØ¨ Ú©Ù†ØªØ±Ù„ Ø¨Ø±Ø§ÛŒ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§
            tabEmojiCategories = new TabControl
            {
                Location = new Point(10, 105),
                Size = new Size(540, 235),
                Font = new Font("Segoe UI", 9)
            };
            emojiPanel.Controls.Add(tabEmojiCategories);
            
            // Ø§ÛŒØ¬Ø§Ø¯ ØªØ¨â€ŒÙ‡Ø§ Ùˆ Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø§Ù…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ Ø¨Ù‡ Ù‡Ø± Ø¯Ø³ØªÙ‡
            foreach (var category in emojiCategories)
            {
                TabPage tabPage = new TabPage(category.Key);
                tabPage.RightToLeft = RightToLeft.Yes;
                
                FlowLayoutPanel flowPanel = new FlowLayoutPanel
                {
                    Dock = DockStyle.Fill,
                    AutoScroll = true,
                    FlowDirection = FlowDirection.RightToLeft
                };
                
                // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ù…ÙˆØ¬ÛŒ Ø¨Ù‡ Ù¾Ù†Ù„
                foreach (var emoji in category.Value)
                {
                    Button btnEmoji = CreateEmojiButton(emoji);
                    flowPanel.Controls.Add(btnEmoji);
                }
                
                tabPage.Controls.Add(flowPanel);
                tabEmojiCategories.TabPages.Add(tabPage);
            }
        }

        private Button CreateEmojiButton(string emoji)
        {
            Button btnEmoji = new Button
            {
                Text = emoji,
                Size = new Size(40, 40),
                Margin = new Padding(3),
                Font = new Font("Segoe UI", 12),
                FlatStyle = FlatStyle.Flat,
                UseVisualStyleBackColor = true
            };
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù…Ù†ÙˆÛŒ Ø±Ø§Ø³Øª Ú©Ù„ÛŒÚ© Ø¨Ø±Ø§ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ù¾Ø±Ú©Ø§Ø±Ø¨Ø±Ø¯Ù‡Ø§
            ContextMenuStrip contextMenu = new ContextMenuStrip();
            ToolStripMenuItem addToFavoritesItem = new ToolStripMenuItem("Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ù¾Ø±Ú©Ø§Ø±Ø¨Ø±Ø¯Ù‡Ø§");
            addToFavoritesItem.Click += (sender, e) => 
            {
                SaveFavoriteEmoji(emoji);
            };
            contextMenu.Items.Add(addToFavoritesItem);
            btnEmoji.ContextMenuStrip = contextMenu;
            
            btnEmoji.Click += (sender, e) => 
            {
                // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø§Ù…ÙˆØ¬ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ Ø¨Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª ÙØ¹Ù„ÛŒ Ú©Ø±Ø³Ø±
                int cursorPosition = txtMessage.SelectionStart;
                txtMessage.Text = txtMessage.Text.Insert(cursorPosition, emoji);
                txtMessage.SelectionStart = cursorPosition + emoji.Length;
                
                // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ù„ÛŒØ³Øª Ù¾Ø±Ú©Ø§Ø±Ø¨Ø±Ø¯Ù‡Ø§
                SaveFavoriteEmoji(emoji);
                
                // ØªÙ…Ø±Ú©Ø² Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø±ÙˆÛŒ TextBox
                txtMessage.Focus();
            };
            
            return btnEmoji;
        }

        private void UpdateFavoriteEmojisPanel()
        {
            favoriteEmojisPanel.Controls.Clear();
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ø±Ú†Ø³Ø¨ Ø¹Ù†ÙˆØ§Ù†
            Label lblTitle = new Label
            {
                Text = "Ù¾Ø±Ú©Ø§Ø±Ø¨Ø±Ø¯Ù‡Ø§:",
                AutoSize = true,
                Margin = new Padding(3, 10, 3, 10),
                Font = new Font("Segoe UI", 9)
            };
            favoriteEmojisPanel.Controls.Add(lblTitle);
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ù…ÙˆØ¬ÛŒ Ù¾Ø±Ú©Ø§Ø±Ø¨Ø±Ø¯
            foreach (var emoji in favoriteEmojis)
            {
                Button btnEmoji = new Button
                {
                    Text = emoji,
                    Size = new Size(35, 35),
                    Margin = new Padding(2),
                    Font = new Font("Segoe UI", 12),
                    FlatStyle = FlatStyle.Flat,
                    UseVisualStyleBackColor = true
                };
                
                btnEmoji.Click += (sender, e) => 
                {
                    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø§Ù…ÙˆØ¬ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ Ø¨Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª ÙØ¹Ù„ÛŒ Ú©Ø±Ø³Ø±
                    int cursorPosition = txtMessage.SelectionStart;
                    txtMessage.Text = txtMessage.Text.Insert(cursorPosition, emoji);
                    txtMessage.SelectionStart = cursorPosition + emoji.Length;
                    
                    // ØªÙ…Ø±Ú©Ø² Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø±ÙˆÛŒ TextBox
                    txtMessage.Focus();
                };
                
                favoriteEmojisPanel.Controls.Add(btnEmoji);
            }
        }

        private void TxtSearch_TextChanged(object sender, EventArgs e)
        {
            string searchText = txtSearch.Text.Trim().ToLower();
            
            // Ø§Ú¯Ø± Ù…ØªÙ† Ø¬Ø³ØªØ¬Ùˆ Ù‡Ù…Ø§Ù† Ù…ØªÙ† Ø±Ø§Ù‡Ù†Ù…Ø§ Ø¨Ø§Ø´Ø¯ØŒ Ø¢Ù† Ø±Ø§ Ù†Ø§Ø¯ÛŒØ¯Ù‡ Ø¨Ú¯ÛŒØ±
            if (searchText == "Ø¬Ø³ØªØ¬ÙˆÛŒ Ø§Ù…ÙˆØ¬ÛŒ..." || searchText.ToLower() == "Ø¬Ø³ØªØ¬ÙˆÛŒ Ø§Ù…ÙˆØ¬ÛŒ...")
            {
                // Ø§Ú¯Ø± Ù…ØªÙ† Ø¬Ø³ØªØ¬Ùˆ Ø®Ø§Ù„ÛŒ Ø¨Ø§Ø´Ø¯ØŒ Ù†Ù…Ø§ÛŒØ´ Ù‡Ù…Ù‡ ØªØ¨â€ŒÙ‡Ø§
                tabEmojiCategories.Visible = true;
                return;
            }
            
            // Ø§ÛŒØ¬Ø§Ø¯ ØªØ¨ Ù…ÙˆÙ‚Øª Ø¨Ø±Ø§ÛŒ Ù†ØªØ§ÛŒØ¬ Ø¬Ø³ØªØ¬Ùˆ
            TabPage searchResultTab = null;
            
            foreach (TabPage tab in tabEmojiCategories.TabPages)
            {
                if (tab.Text == "Ù†ØªØ§ÛŒØ¬ Ø¬Ø³ØªØ¬Ùˆ")
                {
                    searchResultTab = tab;
                    searchResultTab.Controls.Clear();
                    break;
                }
            }
            
            if (searchResultTab == null)
            {
                searchResultTab = new TabPage("Ù†ØªØ§ÛŒØ¬ Ø¬Ø³ØªØ¬Ùˆ");
                tabEmojiCategories.TabPages.Add(searchResultTab);
            }
            
            FlowLayoutPanel flowPanel = new FlowLayoutPanel
            {
                Dock = DockStyle.Fill,
                AutoScroll = true,
                FlowDirection = FlowDirection.RightToLeft
            };
            
            // Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ù‡Ù…Ù‡ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§
            List<string> searchResults = new List<string>();
            foreach (var category in emojiCategories)
            {
                // ÙØ±Ø¶ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… Ú©Ù‡ Ø¬Ø³ØªØ¬Ùˆ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø®ÙˆØ¯ Ø§Ù…ÙˆØ¬ÛŒ Ø§Ø³Øª
                // Ø¯Ø± Ù†Ø³Ø®Ù‡ ÙˆØ§Ù‚Ø¹ÛŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ø² ØªÚ¯â€ŒÙ‡Ø§ ÛŒØ§ ØªÙˆØ¶ÛŒØ­Ø§Øª Ù…Ø±ØªØ¨Ø· Ø¨Ø§ Ù‡Ø± Ø§Ù…ÙˆØ¬ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯
                foreach (var emoji in category.Value)
                {
                    if (emoji.Contains(searchText))
                    {
                        searchResults.Add(emoji);
                    }
                }
            }
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù†ØªØ§ÛŒØ¬ Ø¬Ø³ØªØ¬Ùˆ Ø¨Ù‡ Ù¾Ù†Ù„
            foreach (var emoji in searchResults)
            {
                Button btnEmoji = CreateEmojiButton(emoji);
                flowPanel.Controls.Add(btnEmoji);
            }
            
            searchResultTab.Controls.Add(flowPanel);
            tabEmojiCategories.SelectedTab = searchResultTab;
        }

        private void BtnEmoji_Click(object sender, EventArgs e)
        {
            // Ù†Ù…Ø§ÛŒØ´ ÛŒØ§ Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ù¾Ù†Ù„ Ø§Ù…ÙˆØ¬ÛŒ
            emojiPanel.Visible = !emojiPanel.Visible;
            if (emojiPanel.Visible)
                txtSearch.Focus();
        }

        [STAThread]
        static void Main()
        {
            Application.EnableVisualStyles();
            Application.SetCompatibleTextRenderingDefault(false);
            Application.Run(new MainForm());
        }
    }
}
