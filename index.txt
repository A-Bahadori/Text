using System;
using System.Collections.Generic;
using System.Drawing;
using System.Linq;
using System.Windows.Forms;
using System.Runtime.InteropServices; // Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ØªÙˆØ§Ø¨Ø¹ API ÙˆÛŒÙ†Ø¯ÙˆØ²

namespace Emoji2
{
    public partial class MainForm : Form
    {
        // Ø¨Ø±Ø§ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ú¯ÙˆØ´Ù‡â€ŒÙ‡Ø§ÛŒ Ú¯Ø±Ø¯ Ø¯Ø± Ù¾Ù†Ù„ Ù¾Ø§Ù¾â€ŒØ¢Ù¾
        [DllImport("Gdi32.dll", EntryPoint = "CreateRoundRectRgn")]
        private static extern IntPtr CreateRoundRectRgn
        (
            int nLeftRect,
            int nTopRect,
            int nRightRect,
            int nBottomRect,
            int nWidthEllipse,
            int nHeightEllipse
        );

        private TextBox txtMessage;
        private Button btnEmoji;
        private Panel emojiPanel;
        private TabControl tabEmojiCategories;
        private TextBox txtSearch;
        private FlowLayoutPanel favoriteEmojisPanel;
        private List<string> favoriteEmojis;
        
        // Ø¯ÛŒÚ©Ø´Ù†Ø±ÛŒ Ø¨Ø±Ø§ÛŒ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø§Ù…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§
        private Dictionary<string, List<string>> emojiCategories;

        // Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª Ù¾Ù†Ù„ Ù¾Ø§Ù¾â€ŒØ¢Ù¾
        private Point emojiPanelLocation;

        public MainForm()
        {
            InitializeComponent();
            InitializeEmojiCategories();
            LoadFavoriteEmojis();
            SetupControls();
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ú©Ù„ÛŒØ¯ Ù…ÛŒØ§Ù†Ø¨Ø± (Ctrl+E) Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´/Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ù¾Ù†Ù„ Ø§Ù…ÙˆØ¬ÛŒ
            this.KeyPreview = true;
            this.KeyDown += MainForm_KeyDown;
        }

        private void MainForm_KeyDown(object sender, KeyEventArgs e)
        {
            // Ù…ÛŒØ§Ù†Ø¨Ø± Ctrl+E Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´/Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ù¾Ù†Ù„ Ø§Ù…ÙˆØ¬ÛŒ
            if (e.Control && e.KeyCode == Keys.E)
            {
                e.SuppressKeyPress = true;
                emojiPanel.Visible = !emojiPanel.Visible;
                if (emojiPanel.Visible)
                    txtSearch.Focus();
            }
        }

        private void InitializeEmojiCategories()
        {
            // Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù Ø§Ù…ÙˆØ¬ÛŒ
            emojiCategories = new Dictionary<string, List<string>>();
            
            // Ø¯Ø³ØªÙ‡ Ø§Ø­Ø³Ø§Ø³Ø§Øª Ùˆ ØµÙˆØ±Øªâ€ŒÙ‡Ø§
            emojiCategories["Ø§Ø­Ø³Ø§Ø³Ø§Øª"] = new List<string>()
            {
                "ğŸ˜€", "ğŸ˜", "ğŸ˜‚", "ğŸ¤£", "ğŸ˜ƒ", "ğŸ˜„", "ğŸ˜…", "ğŸ˜†",
                "ğŸ˜‰", "ğŸ˜Š", "ğŸ˜‹", "ğŸ˜", "ğŸ˜", "ğŸ˜˜", "ğŸ¥°", "ğŸ˜—",
                "ğŸ˜™", "ğŸ˜š", "ğŸ™‚", "ğŸ¤—", "ğŸ¤©", "ğŸ¤”", "ğŸ¤¨", "ğŸ˜",
                "ğŸ˜‘", "ğŸ˜¶", "ğŸ™„", "ğŸ˜", "ğŸ˜£", "ğŸ˜¥", "ğŸ˜®", "ğŸ¤",
                "ğŸ˜¯", "ğŸ˜ª", "ğŸ˜«", "ğŸ¥±", "ğŸ˜´", "ğŸ˜Œ", "ğŸ˜›", "ğŸ˜œ",
                "ğŸ˜", "ğŸ¤¤", "ğŸ˜’", "ğŸ˜“", "ğŸ˜”", "ğŸ˜•", "ğŸ™ƒ", "ğŸ¤‘",
                "ğŸ˜²", "â˜¹ï¸", "ğŸ™", "ğŸ˜–", "ğŸ˜", "ğŸ˜Ÿ", "ğŸ˜¤", "ğŸ˜¢",
                "ğŸ˜­", "ğŸ˜¦", "ğŸ˜§", "ğŸ˜¨", "ğŸ˜©", "ğŸ¤¯", "ğŸ˜¬", "ğŸ˜°"
            };
            
            // Ø¯Ø³ØªÙ‡ Ø­ÛŒÙˆØ§Ù†Ø§Øª
            emojiCategories["Ø­ÛŒÙˆØ§Ù†Ø§Øª"] = new List<string>()
            {
                "ğŸ¶", "ğŸ±", "ğŸ­", "ğŸ¹", "ğŸ°", "ğŸ¦Š", "ğŸ»", "ğŸ¼",
                "ğŸ¨", "ğŸ¯", "ğŸ¦", "ğŸ®", "ğŸ·", "ğŸ¸", "ğŸµ", "ğŸ”",
                "ğŸ§", "ğŸ¦", "ğŸ¤", "ğŸ¦†", "ğŸ¦…", "ğŸ¦‰", "ğŸ¦‡", "ğŸº",
                "ğŸ—", "ğŸ´", "ğŸ¦„", "ğŸ", "ğŸ›", "ğŸ¦‹", "ğŸŒ", "ğŸ",
                "ğŸœ", "ğŸ¦Ÿ", "ğŸ¦—", "ğŸ•·ï¸", "ğŸ¦‚", "ğŸ¢", "ğŸ", "ğŸ¦",
                "ğŸ¦–", "ğŸ¦•", "ğŸ™", "ğŸ¦‘", "ğŸ¦", "ğŸ¦", "ğŸ¦€", "ğŸ¡",
                "ğŸ ", "ğŸŸ", "ğŸ¬", "ğŸ³", "ğŸ‹", "ğŸ¦ˆ", "ğŸŠ", "ğŸ…"
            };
            
            // Ø¯Ø³ØªÙ‡ ØºØ°Ø§Ù‡Ø§
            emojiCategories["ØºØ°Ø§Ù‡Ø§"] = new List<string>()
            {
                "ğŸ", "ğŸ", "ğŸ", "ğŸŠ", "ğŸ‹", "ğŸŒ", "ğŸ‰", "ğŸ‡",
                "ğŸ“", "ğŸˆ", "ğŸ’", "ğŸ‘", "ğŸ¥­", "ğŸ", "ğŸ¥¥", "ğŸ¥",
                "ğŸ…", "ğŸ†", "ğŸ¥‘", "ğŸ¥¦", "ğŸ¥¬", "ğŸ¥’", "ğŸŒ¶ï¸", "ğŸŒ½",
                "ğŸ¥•", "ğŸ§„", "ğŸ§…", "ğŸ¥”", "ğŸ ", "ğŸ¥", "ğŸ¥¯", "ğŸ",
                "ğŸ¥–", "ğŸ¥¨", "ğŸ§€", "ğŸ¥š", "ğŸ³", "ğŸ§ˆ", "ğŸ¥", "ğŸ§‡",
                "ğŸ¥“", "ğŸ¥©", "ğŸ—", "ğŸ–", "ğŸŒ­", "ğŸ”", "ğŸŸ", "ğŸ•",
                "ğŸ¥ª", "ğŸ¥™", "ğŸ§†", "ğŸŒ®", "ğŸŒ¯", "ğŸ¥—", "ğŸ¥˜", "ğŸ¥«"
            };
            
            // Ø¯Ø³ØªÙ‡ Ø¹Ù„Ø§Ø¦Ù… Ùˆ Ù†Ù…Ø§Ø¯Ù‡Ø§
            emojiCategories["Ù†Ù…Ø§Ø¯Ù‡Ø§"] = new List<string>()
            {
                "â¤ï¸", "ğŸ§¡", "ğŸ’›", "ğŸ’š", "ğŸ’™", "ğŸ’œ", "ğŸ–¤", "ğŸ¤",
                "ğŸ¤", "ğŸ’”", "â£ï¸", "ğŸ’•", "ğŸ’", "ğŸ’“", "ğŸ’—", "ğŸ’–",
                "ğŸ’˜", "ğŸ’", "ğŸ’Ÿ", "â˜®ï¸", "âœï¸", "â˜ªï¸", "ğŸ•‰ï¸", "â˜¸ï¸",
                "âœ¡ï¸", "ğŸ”¯", "ğŸ•", "â˜¯ï¸", "â˜¦ï¸", "ğŸ›", "â›", "â™ˆ",
                "â™‰", "â™Š", "â™‹", "â™Œ", "â™", "â™", "â™", "â™",
                "â™‘", "â™’", "â™“", "ğŸ†”", "âš›ï¸", "ğŸ‰‘", "â˜¢ï¸", "â˜£ï¸",
                "ğŸ“´", "ğŸ“³", "ğŸˆ¶", "ğŸˆš", "ğŸˆ¸", "ğŸˆº", "ğŸˆ·ï¸", "âœ´ï¸"
            };
            
            // Ø¯Ø³ØªÙ‡ Ø§Ø´ÛŒØ§Ø¡
            emojiCategories["Ø§Ø´ÛŒØ§Ø¡"] = new List<string>()
            {
                "âŒš", "ğŸ“±", "ğŸ’»", "âŒ¨ï¸", "ğŸ–¥ï¸", "ğŸ–¨ï¸", "ğŸ–±ï¸", "ğŸ–²ï¸",
                "ğŸ’½", "ğŸ’¾", "ğŸ’¿", "ğŸ“€", "ğŸ“¼", "ğŸ“·", "ğŸ“¸", "ğŸ“¹",
                "ğŸ¥", "ğŸ“½ï¸", "ğŸï¸", "ğŸ“", "â˜ï¸", "ğŸ“Ÿ", "ğŸ“ ", "ğŸ“º",
                "ğŸ“»", "ğŸ™ï¸", "ğŸšï¸", "ğŸ›ï¸", "ğŸ§­", "â±ï¸", "â²ï¸", "â°",
                "ğŸ•°ï¸", "âŒ›", "â³", "ğŸ“¡", "ğŸ”‹", "ğŸ”Œ", "ğŸ’¡", "ğŸ”¦",
                "ğŸ•¯ï¸", "ğŸ§¯", "ğŸ›¢ï¸", "ğŸ’¸", "ğŸ’µ", "ğŸ’´", "ğŸ’¶", "ğŸ’·",
                "ğŸ’°", "ğŸ’³", "ğŸ’", "âš–ï¸", "ğŸ§°", "ğŸ”§", "ğŸ”¨", "âš’ï¸"
            };
            
            // Ø§Ù…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ú©Ø§Ø±Ø¨Ø±Ø¯ Ø§ÙˆÙ„ÛŒÙ‡
            favoriteEmojis = new List<string>() { "ğŸ‘", "ğŸ‘‹", "â¤ï¸", "ğŸ˜‚", "ğŸ™", "ğŸ‘", "ğŸ”¥", "ğŸ‰" };
        }

        private void LoadFavoriteEmojis()
        {
            try
            {
                // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ ÙØ§ÛŒÙ„ Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ
                string filePath = System.IO.Path.Combine(Application.StartupPath, "favorite_emojis.txt");
                if (System.IO.File.Exists(filePath))
                {
                    // Ø®ÙˆØ§Ù†Ø¯Ù† Ø§ÛŒÙ…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ú©Ø§Ø±Ø¨Ø±Ø¯ Ø§Ø² ÙØ§ÛŒÙ„
                    string[] emojis = System.IO.File.ReadAllLines(filePath);
                    favoriteEmojis = new List<string>(emojis);
                }
                else
                {
                    // Ø§Ú¯Ø± ÙØ§ÛŒÙ„ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø´ØªØŒ Ø§Ø² Ù„ÛŒØ³Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
                    favoriteEmojis = new List<string>() { "ğŸ‘", "ğŸ‘‹", "â¤ï¸", "ğŸ˜‚", "ğŸ™", "ğŸ‘", "ğŸ”¥", "ğŸ‰" };
                }
            }
            catch (Exception ex)
            {
                // Ø¯Ø± ØµÙˆØ±Øª Ø¨Ø±ÙˆØ² Ø®Ø·Ø§ØŒ Ø§Ø² Ù„ÛŒØ³Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
                favoriteEmojis = new List<string>() { "ğŸ‘", "ğŸ‘‹", "â¤ï¸", "ğŸ˜‚", "ğŸ™", "ğŸ‘", "ğŸ”¥", "ğŸ‰" };
                MessageBox.Show("Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÛŒÙ…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ú©Ø§Ø±Ø¨Ø±Ø¯: " + ex.Message, "Ø®Ø·Ø§", MessageBoxButtons.OK, MessageBoxIcon.Error);
            }
        }

        private void SaveFavoriteEmoji(string emoji)
        {
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ù„ÛŒØ³Øª Ù¾Ø±Ú©Ø§Ø±Ø¨Ø±Ø¯Ù‡Ø§ Ø§Ú¯Ø± Ù‚Ø¨Ù„Ø§Ù‹ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯
            if (!favoriteEmojis.Contains(emoji))
            {
                favoriteEmojis.Add(emoji);
                // Ù…Ø­Ø¯ÙˆØ¯ Ú©Ø±Ø¯Ù† ØªØ¹Ø¯Ø§Ø¯ Ø§Ù…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ú©Ø§Ø±Ø¨Ø±Ø¯ Ø¨Ù‡ 20 Ù…ÙˆØ±Ø¯
                if (favoriteEmojis.Count > 20)
                    favoriteEmojis.RemoveAt(0);
                
                // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù¾Ù†Ù„ Ø§Ù…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ú©Ø§Ø±Ø¨Ø±Ø¯
                UpdateFavoriteEmojisPanel();
                
                // Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù„ÛŒØ³Øª Ø¨Ù‡â€ŒØ±ÙˆØ² Ø´Ø¯Ù‡ Ø¯Ø± ÙØ§ÛŒÙ„
                SaveFavoritesToFile();
            }
        }

        private void SetupControls()
        {
            // ØªÙ†Ø¸ÛŒÙ… ÙØ±Ù… Ø§ØµÙ„ÛŒ
            this.Text = "Ù¾ÛŒØ§Ù…â€ŒØ±Ø³Ø§Ù† Ø¨Ø§ Ø§Ù†ØªØ®Ø§Ø¨Ú¯Ø± Ø§Ù…ÙˆØ¬ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡";
            this.Size = new Size(600, 550);
            this.StartPosition = FormStartPosition.CenterScreen;
            this.RightToLeft = RightToLeft.Yes; // Ø¨Ø±Ø§ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² Ø²Ø¨Ø§Ù† ÙØ§Ø±Ø³ÛŒ
            
            // Ø§ÛŒØ¬Ø§Ø¯ TextBox Ø¨Ø±Ø§ÛŒ Ù†ÙˆØ´ØªÙ† Ù¾ÛŒØ§Ù…
            txtMessage = new TextBox
            {
                Multiline = true,
                Location = new Point(10, 10),
                Size = new Size(500, 100),
                Font = new Font("Segoe UI", 12),
                RightToLeft = RightToLeft.Yes,
                ScrollBars = ScrollBars.Vertical
            };
            this.Controls.Add(txtMessage);
            
            // Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ú©Ù…Ù‡ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù¾Ù†Ù„ Ø§Ù…ÙˆØ¬ÛŒ
            btnEmoji = new Button
            {
                Text = "ğŸ˜Š",
                Location = new Point(520, 10),
                Size = new Size(50, 50),
                Font = new Font("Segoe UI", 16)
            };
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† ØªÙˆÙ„ØªÛŒÙ¾ Ø¨Ù‡ Ø¯Ú©Ù…Ù‡ Ø§Ù…ÙˆØ¬ÛŒ
            ToolTip emojiButtonTooltip = new ToolTip();
            emojiButtonTooltip.SetToolTip(btnEmoji, "Ù†Ù…Ø§ÛŒØ´ Ø§Ù…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ (Ctrl+E)");
            btnEmoji.Click += BtnEmoji_Click;
            this.Controls.Add(btnEmoji);
            
            // Ø§ÛŒØ¬Ø§Ø¯ Ù¾Ù†Ù„ Ø§ØµÙ„ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø§Ù…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ù¾Ø§Ù¾â€ŒØ¢Ù¾
            emojiPanel = new Panel
            {
                Size = new Size(560, 350),
                BorderStyle = BorderStyle.None,
                Visible = false,
                BackColor = Color.White,
                AutoScroll = true // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù‚Ø§Ø¨Ù„ÛŒØª Ø§Ø³Ú©Ø±ÙˆÙ„ Ø®ÙˆØ¯Ú©Ø§Ø±
            };
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø³Ø§ÛŒÙ‡ Ùˆ Ú¯ÙˆØ´Ù‡â€ŒÙ‡Ø§ÛŒ Ú¯Ø±Ø¯ Ø¨Ù‡ Ù¾Ù†Ù„
            emojiPanel.Paint += (s, e) => {
                // Ø§ÛŒØ¬Ø§Ø¯ Ø³Ø§ÛŒÙ‡ Ùˆ Ø­Ø§Ø´ÛŒÙ‡
                Rectangle rect = new Rectangle(0, 0, emojiPanel.Width - 1, emojiPanel.Height - 1);
                using (GraphicsPath path = new GraphicsPath())
                {
                    int radius = 10;
                    path.AddArc(rect.X, rect.Y, radius, radius, 180, 90);
                    path.AddArc(rect.Right - radius, rect.Y, radius, radius, 270, 90);
                    path.AddArc(rect.Right - radius, rect.Bottom - radius, radius, radius, 0, 90);
                    path.AddArc(rect.X, rect.Bottom - radius, radius, radius, 90, 90);
                    path.CloseAllFigures();
                    
                    e.Graphics.SmoothingMode = System.Drawing.Drawing2D.SmoothingMode.AntiAlias;
                    using (Pen pen = new Pen(Color.FromArgb(180, 180, 180), 1))
                    {
                        e.Graphics.DrawPath(pen, path);
                    }
                    
                    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø³Ø§ÛŒÙ‡ Ù†Ø±Ù…
                    for (int i = 1; i <= 5; i++)
                    {
                        using (Pen shadowPen = new Pen(Color.FromArgb(20, 0, 0, 0), 1))
                        {
                            e.Graphics.DrawRectangle(shadowPen, rect.X - i, rect.Y - i, rect.Width + i * 2, rect.Height + i * 2);
                        }
                    }
                }
            };
            
            // ØªÙ†Ø¸ÛŒÙ… Ù†Ø§Ø­ÛŒÙ‡ Ú¯Ø±Ø¯ Ø¨Ø±Ø§ÛŒ Ù¾Ù†Ù„
            emojiPanel.Region = System.Drawing.Region.FromHrgn(CreateRoundRectRgn(0, 0, emojiPanel.Width, emojiPanel.Height, 10, 10));
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù‚Ø§Ø¨Ù„ÛŒØª ØªØºÛŒÛŒØ± Ø§Ù†Ø¯Ø§Ø²Ù‡ Ø¨Ù‡ Ù¾Ù†Ù„
            emojiPanel.Resize += (s, e) => {
                // ØªÙ†Ø¸ÛŒÙ… Ù…Ø¬Ø¯Ø¯ Ù…ÙˆÙ‚Ø¹ÛŒØª Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø§Ù†Ø¯Ø§Ø²Ù‡ Ø¬Ø¯ÛŒØ¯ Ù¾Ù†Ù„
                if (txtSearch != null) txtSearch.Width = emojiPanel.Width - 20;
                if (favoriteEmojisPanel != null) favoriteEmojisPanel.Width = emojiPanel.Width - 20;
                if (tabEmojiCategories != null) {
                    tabEmojiCategories.Width = emojiPanel.Width - 20;
                    tabEmojiCategories.Height = emojiPanel.Height - tabEmojiCategories.Top - 10;
                }
            };
            
            // ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø±Ø§ÛŒ Ø­Ø§Ù„Øª Ù¾Ø§Ù¾â€ŒØ¢Ù¾
            emojiPanel.Paint += (s, e) => {
                e.Graphics.DrawRectangle(new Pen(Color.Gray, 1), 0, 0, emojiPanel.Width - 1, emojiPanel.Height - 1);
            };
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø³Ø§ÛŒÙ‡ Ø¨Ù‡ Ù¾Ù†Ù„
            emojiPanel.Region = System.Drawing.Region.FromHrgn(CreateRoundRectRgn(0, 0, emojiPanel.Width, emojiPanel.Height, 10, 10));
            this.Controls.Add(emojiPanel);
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡ Ø¨Ø³ØªÙ† Ø¨Ù‡ Ù¾Ù†Ù„ Ù¾Ø§Ù¾â€ŒØ¢Ù¾
            Button btnClosePanel = new Button
            {
                Text = "Ã—",
                Size = new Size(25, 25),
                Location = new Point(emojiPanel.Width - 30, 5),
                FlatStyle = FlatStyle.Flat,
                Font = new Font("Arial", 12, FontStyle.Bold),
                ForeColor = Color.Red,
                BackColor = Color.White,
                Cursor = Cursors.Hand
            };
            btnClosePanel.FlatAppearance.BorderSize = 0;
            btnClosePanel.Click += (s, e) => emojiPanel.Visible = false;
            emojiPanel.Controls.Add(btnClosePanel);
            
            // Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ø¯Ø± Ø¬Ø³ØªØ¬Ùˆ Ø¨Ø±Ø§ÛŒ Ø§Ù…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§
            txtSearch = new TextBox
            {
                Location = new Point(10, 10),
                Size = new Size(540, 25),
                Font = new Font("Segoe UI", 10)
            };
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù…ØªÙ† Ø±Ø§Ù‡Ù†Ù…Ø§ (Placeholder) Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø±ÙˆÛŒØ¯Ø§Ø¯
            txtSearch.Text = "Ø¬Ø³ØªØ¬ÙˆÛŒ Ø§Ù…ÙˆØ¬ÛŒ...";
            txtSearch.ForeColor = Color.Gray;
            txtSearch.GotFocus += (s, e) => 
            {
                if (txtSearch.Text == "Ø¬Ø³ØªØ¬ÙˆÛŒ Ø§Ù…ÙˆØ¬ÛŒ...")
                {
                    txtSearch.Text = "";
                    txtSearch.ForeColor = Color.Black;
                }
            };
            txtSearch.LostFocus += (s, e) => 
            {
                if (string.IsNullOrWhiteSpace(txtSearch.Text))
                {
                    txtSearch.Text = "Ø¬Ø³ØªØ¬ÙˆÛŒ Ø§Ù…ÙˆØ¬ÛŒ...";
                    txtSearch.ForeColor = Color.Gray;
                }
            };
            txtSearch.TextChanged += TxtSearch_TextChanged;
            emojiPanel.Controls.Add(txtSearch);
            
            // Ø§ÛŒØ¬Ø§Ø¯ Ù¾Ù†Ù„ Ø¨Ø±Ø§ÛŒ Ø§Ù…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ú©Ø§Ø±Ø¨Ø±Ø¯
            favoriteEmojisPanel = new FlowLayoutPanel
            {
                Location = new Point(10, 45),
                Size = new Size(540, 50),
                BorderStyle = BorderStyle.FixedSingle,
                FlowDirection = FlowDirection.LeftToRight
            };
            emojiPanel.Controls.Add(favoriteEmojisPanel);
            UpdateFavoriteEmojisPanel();
            
            // Ø§ÛŒØ¬Ø§Ø¯ ØªØ¨ Ú©Ù†ØªØ±Ù„ Ø¨Ø±Ø§ÛŒ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§
            tabEmojiCategories = new TabControl
            {
                Location = new Point(10, 105),
                Size = new Size(540, 235),
                Font = new Font("Segoe UI", 9)
            };
            emojiPanel.Controls.Add(tabEmojiCategories);
            
            // Ø§ÛŒØ¬Ø§Ø¯ ØªØ¨â€ŒÙ‡Ø§ Ùˆ Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø§Ù…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ Ø¨Ù‡ Ù‡Ø± Ø¯Ø³ØªÙ‡
            foreach (var category in emojiCategories)
            {
                TabPage tabPage = new TabPage(category.Key);
                tabPage.RightToLeft = RightToLeft.Yes;
                
                FlowLayoutPanel flowPanel = new FlowLayoutPanel
                {
                    Dock = DockStyle.Fill,
                    AutoScroll = true,
                    FlowDirection = FlowDirection.RightToLeft
                };
                
                // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ù…ÙˆØ¬ÛŒ Ø¨Ù‡ Ù¾Ù†Ù„
                foreach (var emoji in category.Value)
                {
                    Button btnEmoji = CreateEmojiButton(emoji);
                    flowPanel.Controls.Add(btnEmoji);
                }
                
                tabPage.Controls.Add(flowPanel);
                tabEmojiCategories.TabPages.Add(tabPage);
            }
        }

        private Button CreateEmojiButton(string emoji)
        {
            Button btnEmoji = new Button
            {
                Text = emoji,
                Size = new Size(40, 40),
                Margin = new Padding(3),
                Font = new Font("Segoe UI", 12),
                FlatStyle = FlatStyle.Flat,
                UseVisualStyleBackColor = true
            };
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù…Ù†ÙˆÛŒ Ø±Ø§Ø³Øª Ú©Ù„ÛŒÚ© Ø¨Ø±Ø§ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ù¾Ø±Ú©Ø§Ø±Ø¨Ø±Ø¯Ù‡Ø§
            ContextMenuStrip contextMenu = new ContextMenuStrip();
            ToolStripMenuItem addToFavoritesItem = new ToolStripMenuItem("Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ù¾Ø±Ú©Ø§Ø±Ø¨Ø±Ø¯Ù‡Ø§");
            addToFavoritesItem.Click += (sender, e) => 
            {
                SaveFavoriteEmoji(emoji);
            };
            contextMenu.Items.Add(addToFavoritesItem);
            btnEmoji.ContextMenuStrip = contextMenu;
            
            btnEmoji.Click += (sender, e) => 
            {
                // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø§Ù…ÙˆØ¬ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ Ø¨Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª ÙØ¹Ù„ÛŒ Ú©Ø±Ø³Ø±
                int cursorPosition = txtMessage.SelectionStart;
                txtMessage.Text = txtMessage.Text.Insert(cursorPosition, emoji);
                txtMessage.SelectionStart = cursorPosition + emoji.Length;
                
                // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ù„ÛŒØ³Øª Ù¾Ø±Ú©Ø§Ø±Ø¨Ø±Ø¯Ù‡Ø§
                SaveFavoriteEmoji(emoji);
                
                // ØªÙ…Ø±Ú©Ø² Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø±ÙˆÛŒ TextBox
                txtMessage.Focus();
            };
            
            return btnEmoji;
        }

        private void UpdateFavoriteEmojisPanel()
        {
            favoriteEmojisPanel.Controls.Clear();
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ø±Ú†Ø³Ø¨ Ø¹Ù†ÙˆØ§Ù†
            Label lblTitle = new Label
            {
                Text = "Ù¾Ø±Ú©Ø§Ø±Ø¨Ø±Ø¯Ù‡Ø§:",
                AutoSize = true,
                Margin = new Padding(3, 10, 3, 10),
                Font = new Font("Segoe UI", 9)
            };
            favoriteEmojisPanel.Controls.Add(lblTitle);
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ù…ÙˆØ¬ÛŒ Ù¾Ø±Ú©Ø§Ø±Ø¨Ø±Ø¯
            foreach (var emoji in favoriteEmojis)
            {
                Button btnEmoji = new Button
                {
                    Text = emoji,
                    Size = new Size(35, 35),
                    Margin = new Padding(2),
                    Font = new Font("Segoe UI", 12),
                    FlatStyle = FlatStyle.Flat,
                    UseVisualStyleBackColor = true
                };
                
                btnEmoji.Click += (sender, e) => 
                {
                    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø§Ù…ÙˆØ¬ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ Ø¨Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª ÙØ¹Ù„ÛŒ Ú©Ø±Ø³Ø±
                    int cursorPosition = txtMessage.SelectionStart;
                    txtMessage.Text = txtMessage.Text.Insert(cursorPosition, emoji);
                    txtMessage.SelectionStart = cursorPosition + emoji.Length;
                    
                    // ØªÙ…Ø±Ú©Ø² Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø±ÙˆÛŒ TextBox
                    txtMessage.Focus();
                };
                
                // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù…Ù†ÙˆÛŒ Ø±Ø§Ø³Øª Ú©Ù„ÛŒÚ© Ø¨Ø±Ø§ÛŒ Ø­Ø°Ù Ø§Ø² Ù¾Ø±Ú©Ø§Ø±Ø¨Ø±Ø¯Ù‡Ø§
                ContextMenuStrip contextMenu = new ContextMenuStrip();
                ToolStripMenuItem removeFromFavoritesItem = new ToolStripMenuItem("Ø­Ø°Ù Ø§Ø² Ù¾Ø±Ú©Ø§Ø±Ø¨Ø±Ø¯Ù‡Ø§");
                removeFromFavoritesItem.Click += (sender, e) => 
                {
                    RemoveFavoriteEmoji(emoji);
                };
                contextMenu.Items.Add(removeFromFavoritesItem);
                btnEmoji.ContextMenuStrip = contextMenu;
                
                favoriteEmojisPanel.Controls.Add(btnEmoji);
            }
        }

        // Ù…ØªØ¯ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø­Ø°Ù Ø§ÛŒÙ…ÙˆØ¬ÛŒ Ø§Ø² Ù¾Ø±Ú©Ø§Ø±Ø¨Ø±Ø¯Ù‡Ø§
        private void RemoveFavoriteEmoji(string emoji)
        {
            if (favoriteEmojis.Contains(emoji))
            {
                favoriteEmojis.Remove(emoji);
                UpdateFavoriteEmojisPanel();
                
                // Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù„ÛŒØ³Øª Ø¨Ù‡â€ŒØ±ÙˆØ² Ø´Ø¯Ù‡ Ø¯Ø± ÙØ§ÛŒÙ„
                SaveFavoritesToFile();
            }
        }
        
        // Ù…ØªØ¯ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø§ÛŒÙ…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ú©Ø§Ø±Ø¨Ø±Ø¯ Ø¯Ø± ÙØ§ÛŒÙ„
        private void SaveFavoritesToFile()
        {
            try
            {
                string filePath = System.IO.Path.Combine(Application.StartupPath, "favorite_emojis.txt");
                System.IO.File.WriteAllLines(filePath, favoriteEmojis.ToArray());
            }
            catch (Exception ex)
            {
                MessageBox.Show("Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø§ÛŒÙ…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ú©Ø§Ø±Ø¨Ø±Ø¯: " + ex.Message, "Ø®Ø·Ø§", MessageBoxButtons.OK, MessageBoxIcon.Error);
            }
        }

        private void TxtSearch_TextChanged(object sender, EventArgs e)
        {
            string searchText = txtSearch.Text.Trim().ToLower();
            
            // Ø§Ú¯Ø± Ù…ØªÙ† Ø¬Ø³ØªØ¬Ùˆ Ù‡Ù…Ø§Ù† Ù…ØªÙ† Ø±Ø§Ù‡Ù†Ù…Ø§ Ø¨Ø§Ø´Ø¯ØŒ Ø¢Ù† Ø±Ø§ Ù†Ø§Ø¯ÛŒØ¯Ù‡ Ø¨Ú¯ÛŒØ±
            if (searchText == "Ø¬Ø³ØªØ¬ÙˆÛŒ Ø§Ù…ÙˆØ¬ÛŒ..." || searchText.ToLower() == "Ø¬Ø³ØªØ¬ÙˆÛŒ Ø§Ù…ÙˆØ¬ÛŒ..." || string.IsNullOrWhiteSpace(searchText))
            {
                // Ø­Ø°Ù ØªØ¨ Ù†ØªØ§ÛŒØ¬ Ø¬Ø³ØªØ¬Ùˆ Ø§Ú¯Ø± ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯
                for (int i = 0; i < tabEmojiCategories.TabPages.Count; i++)
                {
                    if (tabEmojiCategories.TabPages[i].Text == "Ù†ØªØ§ÛŒØ¬ Ø¬Ø³ØªØ¬Ùˆ")
                    {
                        tabEmojiCategories.TabPages.RemoveAt(i);
                        break;
                    }
                }
                return;
            }
            
            // Ø§ÛŒØ¬Ø§Ø¯ ØªØ¨ Ù…ÙˆÙ‚Øª Ø¨Ø±Ø§ÛŒ Ù†ØªØ§ÛŒØ¬ Ø¬Ø³ØªØ¬Ùˆ
            TabPage searchResultTab = null;
            
            foreach (TabPage tab in tabEmojiCategories.TabPages)
            {
                if (tab.Text == "Ù†ØªØ§ÛŒØ¬ Ø¬Ø³ØªØ¬Ùˆ")
                {
                    searchResultTab = tab;
                    searchResultTab.Controls.Clear();
                    break;
                }
            }
            
            if (searchResultTab == null)
            {
                searchResultTab = new TabPage("Ù†ØªØ§ÛŒØ¬ Ø¬Ø³ØªØ¬Ùˆ");
                tabEmojiCategories.TabPages.Add(searchResultTab);
            }
            
            FlowLayoutPanel flowPanel = new FlowLayoutPanel
            {
                Dock = DockStyle.Fill,
                AutoScroll = true,
                FlowDirection = FlowDirection.RightToLeft
            };
            
            // Ø¯ÛŒÚ©Ø´Ù†Ø±ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ ØªÙˆØ¶ÛŒØ­Ø§Øª Ø§Ù…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ (Ø¨Ø±Ø§ÛŒ Ø¨Ù‡Ø¨ÙˆØ¯ Ø¬Ø³ØªØ¬Ùˆ)
            Dictionary<string, string> emojiDescriptions = new Dictionary<string, string>()
            {
                // Ø§Ø­Ø³Ø§Ø³Ø§Øª
                { "ğŸ˜€", "Ø®Ù†Ø¯Ù‡ Ù„Ø¨Ø®Ù†Ø¯ Ø´Ø§Ø¯ÛŒ Ø®ÙˆØ´Ø­Ø§Ù„ÛŒ" },
                { "ğŸ˜", "Ø®Ù†Ø¯Ù‡ Ù„Ø¨Ø®Ù†Ø¯ Ø´Ø§Ø¯ÛŒ Ø®ÙˆØ´Ø­Ø§Ù„ÛŒ Ø¯Ù†Ø¯Ø§Ù†" },
                { "ğŸ˜‚", "Ø®Ù†Ø¯Ù‡ Ø§Ø´Ú© Ø´Ø§Ø¯ÛŒ Ø®ÙˆØ´Ø­Ø§Ù„ÛŒ" },
                { "ğŸ¤£", "Ø®Ù†Ø¯Ù‡ ØºØ´ Ø§Ø´Ú© Ø´Ø§Ø¯ÛŒ Ø®ÙˆØ´Ø­Ø§Ù„ÛŒ" },
                { "ğŸ˜ƒ", "Ø®Ù†Ø¯Ù‡ Ù„Ø¨Ø®Ù†Ø¯ Ø´Ø§Ø¯ÛŒ Ø®ÙˆØ´Ø­Ø§Ù„ÛŒ Ø¯Ù‡Ø§Ù† Ø¨Ø§Ø²" },
                { "ğŸ˜„", "Ø®Ù†Ø¯Ù‡ Ù„Ø¨Ø®Ù†Ø¯ Ø´Ø§Ø¯ÛŒ Ø®ÙˆØ´Ø­Ø§Ù„ÛŒ Ø¯Ù‡Ø§Ù† Ø¨Ø§Ø² Ø¯Ù†Ø¯Ø§Ù†" },
                { "ğŸ˜…", "Ø®Ù†Ø¯Ù‡ Ù„Ø¨Ø®Ù†Ø¯ Ø´Ø§Ø¯ÛŒ Ø®ÙˆØ´Ø­Ø§Ù„ÛŒ Ø¹Ø±Ù‚" },
                { "ğŸ˜†", "Ø®Ù†Ø¯Ù‡ Ù„Ø¨Ø®Ù†Ø¯ Ø´Ø§Ø¯ÛŒ Ø®ÙˆØ´Ø­Ø§Ù„ÛŒ Ú†Ø´Ù… Ø¨Ø³ØªÙ‡" },
                { "ğŸ˜‰", "Ú†Ø´Ù…Ú© Ù„Ø¨Ø®Ù†Ø¯" },
                { "ğŸ˜Š", "Ù„Ø¨Ø®Ù†Ø¯ Ø´Ø§Ø¯ÛŒ Ø®ÙˆØ´Ø­Ø§Ù„ÛŒ Ú†Ø´Ù…" },
                { "ğŸ˜‹", "Ù„Ø¨Ø®Ù†Ø¯ ØºØ°Ø§ Ø®ÙˆØ´Ù…Ø²Ù‡ Ø²Ø¨Ø§Ù†" },
                { "ğŸ˜", "Ø¨Ø§Ø­Ø§Ù„ Ø¹ÛŒÙ†Ú© Ø®ÙÙ†" },
                { "ğŸ˜", "Ø¹Ø´Ù‚ Ù‚Ù„Ø¨ Ú†Ø´Ù… Ù…Ø­Ø¨Øª" },
                { "ğŸ˜˜", "Ø¨ÙˆØ³ Ø¹Ø´Ù‚ Ù‚Ù„Ø¨ Ù…Ø­Ø¨Øª" },
                { "ğŸ¥°", "Ø¹Ø´Ù‚ Ù‚Ù„Ø¨ Ù…Ø­Ø¨Øª" },
                
                // Ø­ÛŒÙˆØ§Ù†Ø§Øª
                { "ğŸ¶", "Ø³Ú¯ Ø­ÛŒÙˆØ§Ù†" },
                { "ğŸ±", "Ú¯Ø±Ø¨Ù‡ Ø­ÛŒÙˆØ§Ù†" },
                { "ğŸ­", "Ù…ÙˆØ´ Ø­ÛŒÙˆØ§Ù†" },
                { "ğŸ¹", "Ù‡Ù…Ø³ØªØ± Ø­ÛŒÙˆØ§Ù†" },
                { "ğŸ°", "Ø®Ø±Ú¯ÙˆØ´ Ø­ÛŒÙˆØ§Ù†" },
                { "ğŸ¦Š", "Ø±ÙˆØ¨Ø§Ù‡ Ø­ÛŒÙˆØ§Ù†" },
                { "ğŸ»", "Ø®Ø±Ø³ Ø­ÛŒÙˆØ§Ù†" },
                { "ğŸ¼", "Ù¾Ø§Ù†Ø¯Ø§ Ø­ÛŒÙˆØ§Ù†" },
                
                // ØºØ°Ø§Ù‡Ø§
                { "ğŸ", "Ø³ÛŒØ¨ Ù…ÛŒÙˆÙ‡ ØºØ°Ø§" },
                { "ğŸ", "Ø³ÛŒØ¨ Ù‚Ø±Ù…Ø² Ù…ÛŒÙˆÙ‡ ØºØ°Ø§" },
                { "ğŸ", "Ú¯Ù„Ø§Ø¨ÛŒ Ù…ÛŒÙˆÙ‡ ØºØ°Ø§" },
                { "ğŸŠ", "Ù¾Ø±ØªÙ‚Ø§Ù„ Ù†Ø§Ø±Ù†Ú¯ÛŒ Ù…ÛŒÙˆÙ‡ ØºØ°Ø§" },
                { "ğŸ‹", "Ù„ÛŒÙ…Ùˆ Ù…ÛŒÙˆÙ‡ ØºØ°Ø§" },
                { "ğŸŒ", "Ù…ÙˆØ² Ù…ÛŒÙˆÙ‡ ØºØ°Ø§" },
                
                // Ù†Ù…Ø§Ø¯Ù‡Ø§
                { "â¤ï¸", "Ù‚Ù„Ø¨ Ø¹Ø´Ù‚ Ù…Ø­Ø¨Øª Ù‚Ø±Ù…Ø²" },
                { "ğŸ§¡", "Ù‚Ù„Ø¨ Ø¹Ø´Ù‚ Ù…Ø­Ø¨Øª Ù†Ø§Ø±Ù†Ø¬ÛŒ" },
                { "ğŸ’›", "Ù‚Ù„Ø¨ Ø¹Ø´Ù‚ Ù…Ø­Ø¨Øª Ø²Ø±Ø¯" },
                { "ğŸ’š", "Ù‚Ù„Ø¨ Ø¹Ø´Ù‚ Ù…Ø­Ø¨Øª Ø³Ø¨Ø²" },
                { "ğŸ’™", "Ù‚Ù„Ø¨ Ø¹Ø´Ù‚ Ù…Ø­Ø¨Øª Ø¢Ø¨ÛŒ" },
                
                // Ø§Ø´ÛŒØ§Ø¡
                { "âŒš", "Ø³Ø§Ø¹Øª Ø²Ù…Ø§Ù†" },
                { "ğŸ“±", "Ù…ÙˆØ¨Ø§ÛŒÙ„ ØªÙ„ÙÙ† Ú¯ÙˆØ´ÛŒ" },
                { "ğŸ’»", "Ù„Ù¾ØªØ§Ù¾ Ú©Ø§Ù…Ù¾ÛŒÙˆØªØ±" },
                { "âŒ¨ï¸", "Ú©ÛŒØ¨ÙˆØ±Ø¯" },
                { "ğŸ–¥ï¸", "Ú©Ø§Ù…Ù¾ÛŒÙˆØªØ± Ù…Ø§Ù†ÛŒØªÙˆØ±" }
            };
            
            // Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ù‡Ù…Ù‡ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§
            List<string> searchResults = new List<string>();
            foreach (var category in emojiCategories)
            {
                // Ø¨Ù‡Ø¨ÙˆØ¯ Ø¬Ø³ØªØ¬Ùˆ - Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ù†Ø§Ù… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ùˆ Ø§Ù…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§
                if (category.Key.ToLower().Contains(searchText))
                {
                    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ Ø§Ù…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ÛŒ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¨Ù‡ Ù†ØªØ§ÛŒØ¬
                    searchResults.AddRange(category.Value);
                }
                else
                {
                    // Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ø§Ù…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ÛŒ Ù‡Ø± Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ
                    foreach (var emoji in category.Value)
                    {
                        // Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ø®ÙˆØ¯ Ø§Ù…ÙˆØ¬ÛŒ
                        if (emoji.Contains(searchText))
                        {
                            searchResults.Add(emoji);
                        }
                        // Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± ØªÙˆØ¶ÛŒØ­Ø§Øª Ø§Ù…ÙˆØ¬ÛŒ
                        else if (emojiDescriptions.ContainsKey(emoji) && 
                                 emojiDescriptions[emoji].ToLower().Contains(searchText))
                        {
                            searchResults.Add(emoji);
                        }
                    }
                }
            }
            
            // Ø­Ø°Ù Ù…ÙˆØ§Ø±Ø¯ ØªÚ©Ø±Ø§Ø±ÛŒ
            searchResults = searchResults.Distinct().ToList();
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù†ØªØ§ÛŒØ¬ Ø¬Ø³ØªØ¬Ùˆ Ø¨Ù‡ Ù¾Ù†Ù„
            if (searchResults.Count > 0)
            {
                // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ø±Ú†Ø³Ø¨ ØªØ¹Ø¯Ø§Ø¯ Ù†ØªØ§ÛŒØ¬
                Label lblResultCount = new Label
                {
                    Text = $"{searchResults.Count} Ù†ØªÛŒØ¬Ù‡ Ø¨Ø±Ø§ÛŒ '{searchText}'",
                    Dock = DockStyle.Top,
                    TextAlign = ContentAlignment.MiddleCenter,
                    Font = new Font("Segoe UI", 9, FontStyle.Bold),
                    ForeColor = Color.DarkBlue,
                    Padding = new Padding(0, 5, 0, 5)
                };
                flowPanel.Controls.Add(lblResultCount);
                
                foreach (var emoji in searchResults)
                {
                    Button btnEmoji = CreateEmojiButton(emoji);
                    flowPanel.Controls.Add(btnEmoji);
                }
            }
            else
            {
                // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ù†ØªÛŒØ¬Ù‡
                Label lblNoResult = new Label
                {
                    Text = $"Ù‡ÛŒÚ† Ù†ØªÛŒØ¬Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ '{searchText}' ÛŒØ§ÙØª Ù†Ø´Ø¯",
                    Dock = DockStyle.Fill,
                    TextAlign = ContentAlignment.MiddleCenter,
                    Font = new Font("Segoe UI", 10),
                    ForeColor = Color.Gray
                };
                flowPanel.Controls.Add(lblNoResult);
            }
            
            searchResultTab.Controls.Add(flowPanel);
            tabEmojiCategories.SelectedTab = searchResultTab;
        }

        private void BtnEmoji_Click(object sender, EventArgs e)
        {
            // ØªÙ†Ø¸ÛŒÙ… Ù…ÙˆÙ‚Ø¹ÛŒØª Ù¾Ù†Ù„ Ù¾Ø§Ù¾â€ŒØ¢Ù¾ Ù†Ø³Ø¨Øª Ø¨Ù‡ Ø¯Ú©Ù…Ù‡ Ø§Ù…ÙˆØ¬ÛŒ
            emojiPanelLocation = btnEmoji.PointToScreen(Point.Empty);
            emojiPanelLocation.Y += btnEmoji.Height + 5;
            emojiPanelLocation = this.PointToClient(emojiPanelLocation);
            
            // ØªÙ†Ø¸ÛŒÙ… Ù…ÙˆÙ‚Ø¹ÛŒØª Ù¾Ù†Ù„
            emojiPanel.Location = emojiPanelLocation;
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø§ÙÚ©Øª Ù†Ù…Ø§ÛŒØ´ Ù¾Ù†Ù„
            if (!emojiPanel.Visible)
            {
                // Ù†Ù…Ø§ÛŒØ´ Ù¾Ù†Ù„ Ø¨Ø§ Ø§ÙÚ©Øª
                emojiPanel.Opacity = 0;
                emojiPanel.Visible = true;
                
                // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ØªØ§ÛŒÙ…Ø± Ø¨Ø±Ø§ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ø§ÙÚ©Øª ÙÛŒØ¯ Ø§ÛŒÙ†
                Timer fadeTimer = new Timer();
                fadeTimer.Interval = 10;
                double opacity = 0;
                
                fadeTimer.Tick += (s, args) => {
                    opacity += 0.1;
                    if (opacity >= 1)
                    {
                        emojiPanel.Opacity = 1;
                        fadeTimer.Stop();
                        fadeTimer.Dispose();
                    }
                    else
                    {
                        emojiPanel.Opacity = opacity;
                    }
                };
                
                fadeTimer.Start();
                txtSearch.Focus();
            }
            else
            {
                // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ù¾Ù†Ù„
                emojiPanel.Visible = false;
            }
        }
        
        // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø±ÙˆÛŒØ¯Ø§Ø¯ Ú©Ù„ÛŒÚ© Ø®Ø§Ø±Ø¬ Ø§Ø² Ù¾Ù†Ù„ Ø¨Ø±Ø§ÛŒ Ø¨Ø³ØªÙ† Ù¾Ù†Ù„ Ù¾Ø§Ù¾â€ŒØ¢Ù¾
        protected override void OnClick(EventArgs e)
        {
            base.OnClick(e);
            if (emojiPanel.Visible && !emojiPanel.Bounds.Contains(this.PointToClient(Cursor.Position)))
            {
                emojiPanel.Visible = false;
            }
        }
    }
}
